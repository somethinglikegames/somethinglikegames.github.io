<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/sass/main.min.f6d044b67731fc418190a304668c848b0e240406fe652d5b63b8b82680bf6950585f1957e5bdc647161ed8b86a2ba218f28847056ae8f4c6c5d98d990c42f613.css integrity="sha512-9tBEtncx/EGBkKMEZoyEiw4kBAb+ZS1bY7i4JoC/aVBYXxlX5b3GRxYe2LhqK6IY8ohHBWro9MbF2Y2ZDEL2Ew=="><link rel=stylesheet href=/css/all.min.a0921f068fa9017ba1288b77420fbde17d89619431fab12b4d996e3e124af17337ac1b80bc2bb62458509e6033ace757405b5881b0c1d0db837dd64c8783b607.css integrity="sha512-oJIfBo+pAXuhKIt3Qg+94X2JYZQx+rErTZluPhJK8XM3rBuAvCu2JFhQnmAzrOdXQFtYgbDB0NuDfdZMh4O2Bw=="><title>Something Like Games | Networking tutorial 3: Login 1 - The game client</title><link rel=apple-touch-icon sizes=57x57 href=/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/ms-icon-144x144.png"><meta name=theme-color content="#ffffff"><meta name=description content="This part of the tutorial series is about the first part of the login process. Following the login process, the game client will be discussed to the point where it can communicate with the gateway server."><meta itemprop=description content="This part of the tutorial series is about the first part of the login process. Following the login process, the game client will be discussed to the point where it can communicate with the gateway server."><meta name=twitter:description content="This part of the tutorial series is about the first part of the login process. Following the login process, the game client will be discussed to the point where it can communicate with the gateway server."><meta property="og:description" content="This part of the tutorial series is about the first part of the login process. Following the login process, the game client will be discussed to the point where it can communicate with the gateway server."></head><body><nav class="navbar is-light" role=navigation aria-label="main navigation"><div class=navbar-brand><a href=/en/ class=navbar-item><img src=/images/brand.webp alt="Something Like Games" width=128px height=28></a>
<a role=checkbox class=navbar-burger aria-label=menu aria-expanded=false data-target=navigation><span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span></a></div><div id=navigation class=navbar-menu><div class=navbar-end><div class=navbar-item><a href=/en/ class="nav link icon-text"><span class=icon><i class='fa fa-home'></i></span><span>Home</span></a></div><div class=navbar-item><a href=/en/contact/ class="nav link icon-text"><span class=icon><i class='fa fa-mail-bulk'></i></span><span>Contact</span></a></div><div class="navbar-item has-dropdown is-hoverable"><a class=navbar-link href=#>English (en)</a><div class="navbar-dropdown is-right"><a href=https://www.somethinglikegames.de/de/blog/2023/network-tutorial-3-login-1/ lang=de class=navbar-item>Deutsch (de)</a></div></div></div></div></nav><section class=section><div class=container><div class=columns><div class="column is-one-fifth"><section id=site-sidebar class=is-hidden-mobile><section id=site-intro class="block has-text-centered"><a href=/en/><img src=/images/logo.webp class=circle width=128px height=128px alt=somethinglikegames.de></a><header></header><main><p>My personal Blog about Game Development as a single person in part time</p></main><footer class="footer has-no-background"><span class=icon><a href=//github.com/somethinglikegames target=_blank rel=noopener title=GitHub class="fab fa-github"></a></span>
<span class=icon><a href=//youtube.com/@somethinglikegames target=_blank rel=noopener title=YouTube class="fab fa-youtube"></a></span>
<span id=cloaked-81bfc7d2f2></span>
<script id=cloaked-script-81bfc7d2f2>var cloakElement=document.getElementById("cloaked-81bfc7d2f2"),link=document.createElement("a"),address="ed.semagekilgnihtemos@ofni".split("").reverse().join("");link.href="mailto:"+address,link.classList="far fa-envelope",link.title="email",cloakElement.parentNode.replaceChild(link,cloakElement)</script></footer></section><div class=block><hr></div><section id=categories class="block categories"><header><h1><a href=/en/categories><span class=icon-text><span class=icon><i class="fa fa-folders"></i></span><span>Categories</span></span></a></h1></header><ul><li><a href=/en/categories/tutorial/><span class=icon-text><span class=icon><i class="fa fa-folder"></i></span><span>tutorial</span></span><span class=count>7</span></a><li><a href=/en/categories/misc/><span class=icon-text><span class=icon><i class="fa fa-folder"></i></span><span>misc</span></span><span class=count>3</span></a><li><a href=/en/categories/news/><span class=icon-text><span class=icon><i class="fa fa-folder"></i></span><span>news</span></span><span class=count>1</span></a></li></ul></section></section></div><div class=column><article class=card><div class=card-image><a href=/en/blog/2023/network-tutorial-3-login-1/ class=cover-image style="--bg-image:url('https://www.somethinglikegames.de/images/blog/2023/network-tutorial-1-overview/godot_networking.webp')"><img class=cover src=https://www.somethinglikegames.de/images/blog/2023/network-tutorial-1-overview/godot_networking.webp alt="Godot Engine Logos, die miteinander 'kommunizieren'"></a><div class=copyright><a href=https://github.com/godotengine/godot/blob/master/LOGO_LICENSE.md class=has-text-grey target=_blank rel="noopener nofollow noreferrer">Godot Engine Logo is licensed under CC-BY-4.0 international</a></div></div><header class=card-header><div class=card-header-title><h2 class=title><a href=/en/blog/2023/network-tutorial-3-login-1/>Networking tutorial 3: Login 1 - The game client</a></h2></div></header><div class="card-content is-size-5 content"><div class=columns><div class=column><time datetime="2023-02-26 12:00:00 +0100 +0100">February 26, 2023</time></div></div><div class=columns><div class=column><div class=tags><span class="tag is-info is-light"><a href=/en/categories/tutorial/ class=has-text-info><span class=icon-text><span class=icon><i class="fa fa-folder"></i></span>
<span>Tutorial</span></span></a></span>
<span class="tag is-link is-light"><a href=/en/tags/networking-tutorial/ class=has-text-link><span class=icon-text><span class=icon><i class="fa fa-tag"></i></span>
<span>Networking-Tutorial</span></span></a></span>
<span class="tag is-link is-light"><a href=/en/tags/godot-engine/ class=has-text-link><span class=icon-text><span class=icon><i class="fa fa-tag"></i></span>
<span>Godot Engine</span></span></a></span>
<span class="tag is-link is-light"><a href=/en/tags/networking/ class=has-text-link><span class=icon-text><span class=icon><i class="fa fa-tag"></i></span>
<span>Networking</span></span></a></span></div></div></div><p>The source code for this tutorial series can be found in this <a href=https://github.com/somethinglikegames/godot4-network-tutorial target=_blank rel="noopener nofollow noreferrer">GitHub repository</a>. The following list shows all articles of this series published so far:</p><ol><li><a href=/en/blog/2023/network-tutorial-1-overview/>Networking tutorial 1: General information and overview</a></li><li><a href=/en/blog/2023/network-tutorial-2-walking-skeleton/>Networking tutorial 2: The "walking skeleton"</a></li><li>Networking tutorial 3: Login 1 - The game client</li><li><a href=/en/blog/2023/network-tutorial-4-login-2/>Networking tutorial 4: Login 2 - gateway and authentication server</a></li><li><a href=/en/blog/2023/network-tutorial-5-login-3/>Networking tutorial 5: Login 3 - world server</a></li><li><a href=/en/blog/2023/network-tutorial-6-dtls/>Networking tutorial 6: Encrypted connections using DTLS</a></li><li><a href=/en/blog/2023/scene-replication/>Scene Replication with Godot 4(.1)</a></li></ol><p>With the help of the <a href=/en/blog/2023/network-tutorial-2-walking-skeleton/>last article</a>, we now have a basic framework consisting of three servers running on UDP ports <code>1909</code>-<code>1911</code> and informing us via console output about connection establishment/disconnection of clients. This article deals with the first part of our login process and we create the game client to the point where it connects to the gateway server and sends the login data there. But before that we will discuss a bit more generally the login process and RPCs in Godot.</p><h3 class="title is-4" id=login-process>Login process</h3><p>In classic synchronous software development, the planned login sequence would look like the sequence diagram below. Although synchronous programming is often more convenient for the developer, it achieves poor results for the user, especially for computationally intensive or latency-robust calls, i.e., whenever a network is involved. In addition, the network layer in Godot based on <a href=http://enet.bespin.org/ target=_blank rel="noopener nofollow noreferrer">ENet</a> is designed for asynchronous communication. This is because broadcasts are also supported, where the server can initiate a function call, a so-called <em>Remote Procedure Call</em> (RPC), to all currently connected clients. How long should such a call take then? Until all, i.e. up to 4k, clients have returned their result? Especially since one must additionally consider that with the Godot RPCs it can also be configured that such calls can be delivered unreliably, so there is no guarantee that a client has received the call or not.</p><figure class="title is-6 center"><img src=/images/blog/2023/network-tutorial-3-login-1/login_sequence_synchrone.webp alt="Synchrone Loginsequenz"><figcaption><h4>Synchrone Loginsequenz</h4></figcaption></figure><p>For this reason, we take the synchronous sequence as a model and reproduce it asynchronously. This means that the respective RPCs take place as shown in the sequence diagram. The &ldquo;waiting time&rdquo; drawn in can now be used for other purposes. For example, the GUI of the game client can continue to respond to user input or display and update a progress bar. The gateway server can respond to further login requests in the same thread. The key is that the responses drawn in are now also RPCs and the gateway server must be able to forward the response to the original invoker.</p><h3 class="title is-4" id=remote-procedure-call-rpc>Remote Procedure Call (RPC)</h3><p>RPC-based communication, along with message-based communication, is a fundamental model of network programming. The beauty of it is that it is similar to a local function call for the developer. In the network layer of Godot <a href=http://enet.bespin.org/ target=_blank rel="noopener nofollow noreferrer">ENet</a> that we use, all RPC calls are asynchronous calls, so in general already functions with return value <code>void</code>. If one wants to have in synchronous way of thinking however a return value one must make likewise a function available, a so-called Callback, which the communication partner calls then with the result (synchronous: Return value) by RPC.</p><p>Between Godot 3.x and Godot 4 the syntax in the network area has changed a lot. I will only talk about the new syntax here, but if you want to have a look at the old syntax, you will surely find it in the <a href=https://docs.godotengine.org/en/3.5/tutorials/networking/high_level_multiplayer.html#rpc target=_blank rel="noopener nofollow noreferrer">old documentation</a>. The first and biggest change is probably the new annotation <code>@rpc</code> for all functions that can be called via RPC.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>@</span>rpc(<span style=color:#e6db74>&#34;call_remote&#34;</span>, <span style=color:#e6db74>&#34;any_peer&#34;</span>, <span style=color:#e6db74>&#34;reliable&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> s_login_request(_username: <span style=color:#a6e22e>String</span>, _password: <span style=color:#a6e22e>String</span>) <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>pass</span></span></span></code></pre></div><p>Four parameters are provided for <code>@rpc</code>:</p><dl><dt><code>mode</code></dt><dd>Specifies who is allowed to call the function. Possible values are <code>"authority"</code> (default) and <code>"any_peer"</code>.</dd><dt><code>sync</code></dt><dd>Determines whether the function is called remotely only or also locally. Possible values are <code>"call_remote"</code> (default) and <code>"call_local"</code>.</dd><dt><code>transfer_mode</code></dt><dd>There are three possible modes in total. <code>unreliable</code> (default) means that the function calls are sent without further guarantees. With <code>unreliable_ordered</code> it can be specified that only the last message sent is evaluated, i.e. if A and then B are sent first and B arrives at the recipient before A, only B is evaluated and A is discarded. If A arrives before B, then of course A is evaluated first and B afterwards. With <code>reliable</code> mechanisms are established to guarantee the arrival of the message/function call (a bit like TCP), which has the consequence that after each <code>reliable</code> dispatch the receiver must acknowledge receipt before the next <code>reliable</code> message can be sent on this channel.</dd><dt><code>channel</code></dt><dd>Determines on which channel a message/function call takes place. All channels are part of the same network connection. The default value is <code>0</code>, otherwise, as far as I can tell at the moment, all other <code>int</code> values are allowed. By using different channels you can e.g. reduce latencies caused by <code>reliable</code> calls by running different <code>reliable</code> calls over different channels. Otherwise, as explained before, each <code>reliable</code> function call waits for the acknowledgement of the receiver before the next <code>reliable</code> function call can be sent on the channel. Another essential use for different channels arises when using the <code>transfer_mode</code> <code>unreliable_ordered</code>, because the sorting refers to all network messages of the channel and not only to the same function calls. As a result, if 3 different RPCs are sent with <code>unreliable_ordered</code> over the same channel, depending on the order of reception, 1 to a maximum of 3 of them will be executed and all those not executed will be discarded, even if each call should call a different function.</dd></dl><p>The order of the first three parameters does not matter, as shown in the example, but the channel must always be specified as the fourth argument.</p><p>More information and smaller examples on this topic can also be found in the related <a href=https://godotengine.org/article/multiplayer-changes-godot-4-0-report-2/ target=_blank rel="noopener nofollow noreferrer">blog post of this syntax change</a>.</p><p>A second syntax change that comes with Godot 4 is that each <code>Callable</code> now has the functions <code>rpc()</code> and <code>rpc_id()</code>. This allows the RPC to be called directly on the <code>callable</code> and you don<code>t really need another general function anymore that has to be passed the function name by string. Thus renaming of functions is noticed directly at compile time and not only at runtime. The difference between </code>rpc()<code>and</code>rpc_id()<code>is that</code>rpc_id()` still specifies the network ID of the recipient. The new syntax in use then looks like this, for example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span><span style=color:#75715e># Neue Syntax:</span>
</span></span><span style=display:flex><span>s_login_request<span style=color:#f92672>.</span>rpc_id(MultiplayerPeer<span style=color:#f92672>.</span>TARGET_PEER_SERVER, username, password)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Alternative/ bisherige Syntax:</span>
</span></span><span style=display:flex><span>rpc_id(MultiplayerPeer<span style=color:#f92672>.</span>TARGET_PEER_SERVER, <span style=color:#e6db74>&#34;s_login_request&#34;</span>, username, password)</span></span></code></pre></div><h3 class="title is-4" id=game-client>Game client</h3><h4 id=login-gui class="title is-5">Login GUI (./scenes/gui/login_screen.tscn)</h4><figure class="is-pulled-left title is-6"><img src=/images/blog/2023/network-tutorial-3-login-1/game_client_login_scenetree.webp alt="SceneTree der Login-GUI"><figcaption><h4>SceneTree der Login-GUI.</h4></figcaption></figure><p>After a long inner struggle whether I should really build a login GUI, we are now starting with just such a GUI. First of all: My knowledge of GUI design, especially with Godot, is quite limited. I&rsquo;m not interested in the most beautiful or best design for this GUI, but in a functionality as useful as possible for this tutorial. Therefore you can also set network address and port for gateway and world server in the GUI. As you can see from the <code>SceneTree</code>, I tried to fit as much functionality as possible into as little design as possible. I had only two criteria for the design: First, the GUI elements should be centered regardless of the window size. Second, labels and input fields (<code>LineEdit</code>) should be neatly placed below each other. With the help of <code>CenterContainer</code> the centering requirement can be implemented very easily, because this container centers all its <code>Control</code> children automatically. I solved my second criterion with a two-column <code>GridContainer</code>. For this to work as desired, the child elements must always alternate between <code>Label</code> and input field. To make sure that this also works for the input fields of the server entries, I combined the respective text fields (<code>LineEdit</code>) for network address and port in an <code>HBoxContainer</code>, so that the alternating order fits. To save me the typing effort, the text fields for gateway and world server are already preset to <code>127.0.0.1</code> and <code>1910</code> or <code>1909</code>. The GUI then looks like this:</p><figure class="is-pulled-left title is-6"><img src=/images/blog/2023/network-tutorial-3-login-1/game_client_login_gui.webp alt=Login-GUI><figcaption><h4>Login-GUI</h4></figcaption></figure><p>Appropriately, the associated GDScript is also kept very simple. It has only two functions:</p><ol><li><code>_on_login_pressed()</code> which is connected to the <code>pressed</code> signal of `login_btn</li><li><code>reset()</code>, which is supposed to reset the GUI</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Control</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#960050;background-color:#1e0010>@</span><span style=color:#66d9ef>onready</span> <span style=color:#66d9ef>var</span> gw_server_addr_txt :<span style=color:#f92672>=</span> <span style=color:#f92672>$</span>Center<span style=color:#f92672>/</span>Grid<span style=color:#f92672>/</span>GatewayServer<span style=color:#f92672>/</span>Server
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#960050;background-color:#1e0010>@</span><span style=color:#66d9ef>onready</span> <span style=color:#66d9ef>var</span> gw_server_port_txt :<span style=color:#f92672>=</span> <span style=color:#f92672>$</span>Center<span style=color:#f92672>/</span>Grid<span style=color:#f92672>/</span>GatewayServer<span style=color:#f92672>/</span>Port
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#960050;background-color:#1e0010>@</span><span style=color:#66d9ef>onready</span> <span style=color:#66d9ef>var</span> world_server_addr_txt :<span style=color:#f92672>=</span> <span style=color:#f92672>$</span>Center<span style=color:#f92672>/</span>Grid<span style=color:#f92672>/</span>WorldServer<span style=color:#f92672>/</span>Server
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#960050;background-color:#1e0010>@</span><span style=color:#66d9ef>onready</span> <span style=color:#66d9ef>var</span> world_server_port_txt :<span style=color:#f92672>=</span> <span style=color:#f92672>$</span>Center<span style=color:#f92672>/</span>Grid<span style=color:#f92672>/</span>WorldServer<span style=color:#f92672>/</span>Port
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#960050;background-color:#1e0010>@</span><span style=color:#66d9ef>onready</span> <span style=color:#66d9ef>var</span> username_txt :<span style=color:#f92672>=</span> <span style=color:#f92672>$</span>Center<span style=color:#f92672>/</span>Grid<span style=color:#f92672>/</span>Username
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#960050;background-color:#1e0010>@</span><span style=color:#66d9ef>onready</span> <span style=color:#66d9ef>var</span> password_txt :<span style=color:#f92672>=</span> <span style=color:#f92672>$</span>Center<span style=color:#f92672>/</span>Grid<span style=color:#f92672>/</span>Password
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#960050;background-color:#1e0010>@</span><span style=color:#66d9ef>onready</span> <span style=color:#66d9ef>var</span> login_btn :<span style=color:#f92672>=</span> <span style=color:#f92672>$</span>Center<span style=color:#f92672>/</span>Grid<span style=color:#f92672>/</span>Login
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#66d9ef>var</span> login : Callable
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#66d9ef>func</span> reset() <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>	login_btn<span style=color:#f92672>.</span>disabled <span style=color:#f92672>=</span> false
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#66d9ef>func</span> _on_login_pressed() <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>	login_btn<span style=color:#f92672>.</span>disabled <span style=color:#f92672>=</span> true
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>	login<span style=color:#f92672>.</span>call(NetworkConnectionData<span style=color:#f92672>.</span>new(gw_server_addr_txt<span style=color:#f92672>.</span>text,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>			gw_server_port_txt<span style=color:#f92672>.</span>text as <span style=color:#a6e22e>int</span>),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>			NetworkConnectionData<span style=color:#f92672>.</span>new(world_server_addr_txt<span style=color:#f92672>.</span>text,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>			world_server_port_txt<span style=color:#f92672>.</span>text as <span style=color:#a6e22e>int</span>),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>			username_txt<span style=color:#f92672>.</span>text, password_txt<span style=color:#f92672>.</span>text)</span></span></code></pre></div><div class="message is-warning"><div class=message-body>It should be noticeable that I have omitted any input validation, which is something you should never do outside of a test application. Without validation, you not only increase the likelihood of user input errors and reduce the UX, but you also make it easier to attack your own backend, since you can send, for example, 1 GB of text to the backend via any input fields, and the backend is probably not designed for this amount of data.</div></div><p>All the &ldquo;magic&rdquo; of this script takes place inside <code>_on_login_pressed()</code>. There, <code>login_btn</code> is first disabled (line 19) to prevent multiple presses. Then a <code>callable</code> named <code>login</code> is called with the contents of the input fields. What exactly is behind <code>login</code>, we will see in a moment. First I added a new class called <code>NetworkConnectionData</code> in <code>./scripts/classes/network_connection_data.gd</code>. As you can see in the source code below, this is just a simple data container that is supposed to bundle network address and port and still has a <code>_to_string()</code> function to produce better console output:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>class_name NetworkConnectionData
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#66d9ef>var</span> address: <span style=color:#a6e22e>String</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#66d9ef>var</span> port: <span style=color:#a6e22e>int</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#66d9ef>func</span> _init(_address: <span style=color:#a6e22e>String</span>, _port: <span style=color:#a6e22e>int</span>) <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>	address <span style=color:#f92672>=</span> _address
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>	port <span style=color:#f92672>=</span> _port
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#66d9ef>func</span> _to_string() <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>String</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>	<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>:</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> [address, port]</span></span></code></pre></div><h4 id=scenehandler class="title is-5">SceneHandler (./scenes/main.tscn)</h4><p>As mentioned briefly in the <a href=/en/blog/2023/network-tutorial-2-walking-skeleton/>previous article</a>, I want to design the startup scene (<code>./scenes/main.tscn</code>) of the game client as a <em>SceneHandler</em>. That is, the entire control flow of the game client is controlled via this scene and the associated GDScript. For this reason the necessary <em>glue</em> code is also to be found there, in order to accomplish the <em>wiring</em> of signals, Callbacks, dependencies etc.:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Node</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#66d9ef>var</span> login_screen :<span style=color:#f92672>=</span> preload(<span style=color:#e6db74>&#34;res://scenes/gui/login_screen.tscn&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#66d9ef>var</span> gateway_server : <span style=color:#a6e22e>Node</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#66d9ef>var</span> world_server_data : NetworkConnectionData
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#66d9ef>func</span> _ready() <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>	_load_login_screen()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#66d9ef>func</span> _load_login_screen() <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>	<span style=color:#66d9ef>for</span> c <span style=color:#f92672>in</span> get_children():
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>		c<span style=color:#f92672>.</span>queue_free()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>	<span style=color:#66d9ef>var</span> instance <span style=color:#f92672>=</span> login_screen<span style=color:#f92672>.</span>instantiate()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>	instance<span style=color:#f92672>.</span>login <span style=color:#f92672>=</span> _login
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>	add_child(instance)</span></span></code></pre></div><p>When the game client is started, the function <code>_load_login_screen()</code> (line 10) is called in <code>_ready()</code>. The task of this function is to initialize and load the previously presented scene of the login GUI. Before this happens, however, it is &ldquo;cleaned up&rdquo;. To do this, all children of the scene are passed through in line 14 to preload them for deletion. Then the preloaded <code>login_screen</code> (line 3) is instantiated, the callback <code>login</code> is set and then the login GUI is added to the current <code>SceneTree</code> (line 18).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#66d9ef>func</span> _login(gw_server: NetworkConnectionData, wrld_server: NetworkConnectionData,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>			username: <span style=color:#a6e22e>String</span>, password: <span style=color:#a6e22e>String</span>) <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>	world_server_data <span style=color:#f92672>=</span> wrld_server
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>	gateway_server <span style=color:#f92672>=</span> <span style=color:#a6e22e>Node</span><span style=color:#f92672>.</span>new()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>	gateway_server<span style=color:#f92672>.</span>name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;GatewayServer&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>	add_child(gateway_server)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>	gateway_server<span style=color:#f92672>.</span>set_script(load(<span style=color:#e6db74>&#34;res://scenes/network/gateway_server.gd&#34;</span>))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>	get_tree()<span style=color:#f92672>.</span>set_multiplayer(SceneMultiplayer<span style=color:#f92672>.</span>new(), <span style=color:#f92672>^</span><span style=color:#e6db74>&#34;/root/Main/GatewayServer&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>	gateway_server<span style=color:#f92672>.</span>gateway_server <span style=color:#f92672>=</span> gw_server
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>	gateway_server<span style=color:#f92672>.</span>callback <span style=color:#f92672>=</span> _login_callback
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>	gateway_server<span style=color:#f92672>.</span>login_to_server(username, password)</span></span></code></pre></div><p>As we have already seen <a href=#login-gui>in the section before</a>, the passed callback <code>_login()</code> (line 21-22) is called with the data of all input fields of the login GUI . The network coordinates of the world server are stored in a local variable for later use, while all other information is processed directly. For this purpose, starting at line 24, a <code>Node</code> for the gateway server is created, named, added to the <code>SceneTree</code> and initialized. At the end, the function <code>login_to_server()</code> of the gateway server is called, which then establishes the network connection to the gateway server, which we will take a closer look at in the <a href=#game-client-gw-server>next section</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span><span style=color:#66d9ef>func</span> _login_callback(return_code: <span style=color:#a6e22e>int</span>, token: <span style=color:#a6e22e>String</span>) <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>	remove_child(gateway_server)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>	<span style=color:#66d9ef>if</span> return_code <span style=color:#f92672>==</span> OK:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>		print(<span style=color:#e6db74>&#34;Login was successful&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>		print(<span style=color:#e6db74>&#34;Current Token is: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> token)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>		<span style=color:#75715e># Connect to World Server</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>	<span style=color:#66d9ef>else</span> :
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>		print(<span style=color:#e6db74>&#34;Something went wrongâ€¦&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>		get_node(<span style=color:#e6db74>&#34;LoginScreen&#34;</span>)<span style=color:#f92672>.</span>reset()</span></span></code></pre></div><p>The function <code>_login_callback()</code> (from line 34) hosts the callback for the gateway server. There the <code>node</code> of the gateway server is deleted, because it is no longer needed. Afterwards, in case of success, a small message and the received token are currently output as console message. Later, with the help of the token, the contact to the world server should be established here, but we are not so far yet. In case of error, a small debug message is output and then the function <code>reset()</code> of the <a href=#login-gui>login GUI</a> is called.</p><h4 id=game-client-gw-server class="title is-5">Gateway Server client (./scenes/network/gateway_server.gd)</h4><p>The task of the gateway server client is, as you might guess, to communicate with the gateway server. It is brought to &ldquo;life&rdquo;, as we have already discussed, in the <a href=#scenehandler>SceneHandler</a>, where, after instantiation and initialization, the <code>login_to_server()</code> function is called.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Node</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#66d9ef>var</span> network :<span style=color:#f92672>=</span> ENetMultiplayerPeer<span style=color:#f92672>.</span>new()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#66d9ef>var</span> gateway_server : NetworkConnectionData
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#66d9ef>var</span> username : <span style=color:#a6e22e>String</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#66d9ef>var</span> password : <span style=color:#a6e22e>String</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#66d9ef>var</span> callback : Callable
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#66d9ef>func</span> login_to_server(_username: <span style=color:#a6e22e>String</span>, _password: <span style=color:#a6e22e>String</span>) <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>	username <span style=color:#f92672>=</span> _username
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>	password <span style=color:#f92672>=</span> _password
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>	print(<span style=color:#e6db74>&#34;Connecting to </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> gateway_server<span style=color:#f92672>.</span>to_string())
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>	<span style=color:#66d9ef>var</span> ret <span style=color:#f92672>=</span> network<span style=color:#f92672>.</span>create_client(gateway_server<span style=color:#f92672>.</span>address, gateway_server<span style=color:#f92672>.</span>port)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>	<span style=color:#66d9ef>if</span> ret <span style=color:#f92672>==</span> OK:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>		get_multiplayer()<span style=color:#f92672>.</span>multiplayer_peer <span style=color:#f92672>=</span> network
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>		get_multiplayer()<span style=color:#f92672>.</span>connected_to_server<span style=color:#f92672>.</span>connect(_on_connection_succeeded)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>		get_multiplayer()<span style=color:#f92672>.</span>connection_failed<span style=color:#f92672>.</span>connect(_on_connection_failed<span style=color:#f92672>.</span>bind(FAILED))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>	<span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>		_on_connection_failed(ret)</span></span></code></pre></div><p>To contact the gateway server, an ENet client is first created in line 14. If this was successful, similar to the <a href=/en/blog/2023/network-tutorial-2-walking-skeleton/>last tutorial</a>, the <code>ENetMultiplayerPeer</code> is stored in the <code>Multiplayer</code> object and the signals <code>connected_to_server</code> and <code>connection_failed</code> are linked. In case of an error the function <code>_on_connection_failed()</code> is called directly, where the error handling is triggered.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#66d9ef>func</span> _on_connection_failed(ret: <span style=color:#a6e22e>int</span>) <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>	print(<span style=color:#e6db74>&#34;Failed to connect to gateway server on </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>, errorcode was </span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>			<span style=color:#f92672>%</span> [gateway_server<span style=color:#f92672>.</span>to_string(), ret])
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>	callback<span style=color:#f92672>.</span>call(ret, <span style=color:#e6db74>&#34;&#34;</span>)</span></span></code></pre></div><p>The error handling in <code>_on_connection_failed()</code> is kept very minimalistic. A short console message is issued and then the <code>callback</code> that the <a href=#scenehandler>SceneHandler</a> had specified is called. This function is called not only when the network client generation fails, but also when the <code>connection_failed</code> signal is triggered.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span><span style=color:#66d9ef>func</span> _on_connection_succeeded() <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>	print(<span style=color:#e6db74>&#34;Succesfully connected to gateway server </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> [gateway_server<span style=color:#f92672>.</span>to_string()])
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>	print(<span style=color:#e6db74>&#34;send login request to gateway server&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>	s_login_request<span style=color:#f92672>.</span>rpc_id(MultiplayerPeer<span style=color:#f92672>.</span>TARGET_PEER_SERVER, username, password)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>	username <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>	password <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span><span style=color:#960050;background-color:#1e0010>@</span>rpc(<span style=color:#e6db74>&#34;call_remote&#34;</span>, <span style=color:#e6db74>&#34;any_peer&#34;</span>, <span style=color:#e6db74>&#34;reliable&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span><span style=color:#66d9ef>func</span> s_login_request(_username: <span style=color:#a6e22e>String</span>, _password: <span style=color:#a6e22e>String</span>) <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>	<span style=color:#66d9ef>pass</span> <span style=color:#75715e># on gateway server</span></span></span></code></pre></div><p>When <code>_on_connection_succeeded()</code> is called by <code>connected_to_server</code> after a successful connection to the gateway server, the actual login process takes place there. For this the function <code>s_request_login</code> is called in line 32 as RPC on the server. As parameter the function <code>rpc_id()</code> always has the numeric ID of the remote system in the first place. The server always has the ID 1, which is also available as constant <code>MultiplayerPeer.TARGET_PEER_SERVER</code>. All other parameters are passed to the called function.</p><p>As you can see from line 37, the <code>s_login_request()</code> function is also present in the client, even if it is called exclusively on the server. Besides identical network path and <code>SceneTree</code>, all functions available via RPC must also be present on server and client. All <code>@rpc</code> parameters, the function name and also the passing parameters (number and type) must be the same, whereas the implementations can and should be different. The server cannot care what the client does in its functions and vice versa is even more true. Such functionless implementations are often referred to as stubs. To be able to distinguish between server and client functions I currently start all server functions with <code>s_</code> and all client functions with <code>c_</code>. Additionally, I try to make related communication flows visible by using functions with the same name, which then end with either <code>_request</code> or <code>_response</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span><span style=color:#960050;background-color:#1e0010>@</span>rpc(<span style=color:#e6db74>&#34;call_remote&#34;</span>, <span style=color:#e6db74>&#34;authority&#34;</span>, <span style=color:#e6db74>&#34;reliable&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span><span style=color:#66d9ef>func</span> c_login_response(result: <span style=color:#a6e22e>bool</span>, token: <span style=color:#a6e22e>String</span>) <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span>	print(<span style=color:#e6db74>&#34;login response is </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> str(result))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span>	print(<span style=color:#e6db74>&#34;token is &#39;</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#39;&#34;</span> <span style=color:#f92672>%</span> token)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span>	get_multiplayer()<span style=color:#f92672>.</span>connected_to_server<span style=color:#f92672>.</span>disconnect(_on_connection_succeeded)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span>	multiplayer<span style=color:#f92672>.</span>set_multiplayer_peer(null)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span>	network <span style=color:#f92672>=</span> null
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span>	callback<span style=color:#f92672>.</span>call(OK <span style=color:#66d9ef>if</span> result <span style=color:#66d9ef>else</span> ERR_INVALID_DATA, token)</span></span></code></pre></div><p>The <code>c_login_result()</code> function (line 43) is called by the gateway server in response to <code>s_login_request()</code>. After outputting debug console messages, the connection to the server is disconnected and the <code>Callback</code> is called with the result. From there on, it proceeds as previously shown in the <a href=#scenehandler>SceneHandler</a>. In case of error the login button will be unlocked again and in case of success there will be more console output, as I have planned the communication with the world server for a later tutorial.</p><h3 class="title is-4" id=the-next-step>The next step</h3><p>The next article will deal with the next step: The gateway server receives the login request from the game client and forwards it to the authentication server, which verifies the login data and creates a token if successful. The result is then sent back to the game client via the gateway server.</p></div></article><footer class=columns><div class="column has-text-left"><a href=/en/blog/2023/network-tutorial-2-walking-skeleton/ class="button right"><span class=icon-text><span class=icon><i class="fa fa-angle-left"></i></span><span>Networking tutorial 2: The "walking skeleton"</span></span></a></div><div class="column has-text-right"><a href=/en/blog/2023/network-tutorial-4-login-2/ class="button left"><span class=icon-text><span>Networking tutorial 4: Login 2 - gateway and authentication server</span><span class=icon><i class="fa fa-angle-right"></i></span></span></a></div></footer></div></div></div></section><footer class=footer><div class="container is-fluid has-text-centered"><ul class=socnet-icons><span class=icon><a href=//github.com/somethinglikegames target=_blank rel=noopener title=GitHub class="fab fa-github"></a></span>
<span class=icon><a href=//youtube.com/@somethinglikegames target=_blank rel=noopener title=YouTube class="fab fa-youtube"></a></span>
<span id=cloaked-cddc42174f></span>
<script id=cloaked-script-cddc42174f>var cloakElement=document.getElementById("cloaked-cddc42174f"),link=document.createElement("a"),address="ed.semagekilgnihtemos@ofni".split("").reverse().join("");link.href="mailto:"+address,link.classList="far fa-envelope",link.title="email",cloakElement.parentNode.replaceChild(link,cloakElement)</script></ul><p class=copyright><a href=https://www.somethinglikegames.de/en/legal_notice/>Legal Notice</a> &mdash;
<a href=https://www.somethinglikegames.de/en/privacy_policy/>Privacy Policy</a> &mdash;
Â©2023 Tobias Wink<br>Powered by <a href=https://gohugo.io/ title=0.109.0 target=_blank rel=noopener>Hugo</a></p></div></footer><script src=/js/navbar.min.js defer></script>
<script src=/js/copy-code-button.min.js defer></script></body></html>