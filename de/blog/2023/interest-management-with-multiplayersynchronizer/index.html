<!doctype html><html lang=de><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/sass/main.min.f6d044b67731fc418190a304668c848b0e240406fe652d5b63b8b82680bf6950585f1957e5bdc647161ed8b86a2ba218f28847056ae8f4c6c5d98d990c42f613.css integrity="sha512-9tBEtncx/EGBkKMEZoyEiw4kBAb+ZS1bY7i4JoC/aVBYXxlX5b3GRxYe2LhqK6IY8ohHBWro9MbF2Y2ZDEL2Ew=="><link rel=stylesheet href=/css/all.min.a0921f068fa9017ba1288b77420fbde17d89619431fab12b4d996e3e124af17337ac1b80bc2bb62458509e6033ace757405b5881b0c1d0db837dd64c8783b607.css integrity="sha512-oJIfBo+pAXuhKIt3Qg+94X2JYZQx+rErTZluPhJK8XM3rBuAvCu2JFhQnmAzrOdXQFtYgbDB0NuDfdZMh4O2Bw=="><title>Something Like Games | Interest Management mit dem MultiplayerSynchronizer</title><link rel=apple-touch-icon sizes=57x57 href=/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/ms-icon-144x144.png"><meta name=theme-color content="#ffffff"><meta name=description content="In diesem Tutorial geht es um die Umsetzung von Interest Management mit dem MultiplayerSynchronizer."><meta itemprop=description content="In diesem Tutorial geht es um die Umsetzung von Interest Management mit dem MultiplayerSynchronizer."><meta name=twitter:description content="In diesem Tutorial geht es um die Umsetzung von Interest Management mit dem MultiplayerSynchronizer."><meta property="twitter:image" content="https://www.somethinglikegames.de/images/blog/2023/interest-management-with-multiplayersynchronizer/intro.webp"><meta property="og:description" content="In diesem Tutorial geht es um die Umsetzung von Interest Management mit dem MultiplayerSynchronizer."><meta property="og:image" content="https://www.somethinglikegames.de/images/blog/2023/interest-management-with-multiplayersynchronizer/intro.webp"></head><body><nav class="navbar is-light" role=navigation aria-label="main navigation"><div class=navbar-brand><a href=/de/ class=navbar-item><img src=/images/brand.webp alt="Something Like Games" width=128px height=28></a>
<a role=checkbox class=navbar-burger aria-label=menu aria-expanded=false data-target=navigation><span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span></a></div><div id=navigation class=navbar-menu><div class=navbar-end><div class=navbar-item><a href=/de/ class="nav link icon-text"><span class=icon><i class='fa fa-home'></i></span><span>Home</span></a></div><div class=navbar-item><a href=/de/contact/ class="nav link icon-text"><span class=icon><i class='fa fa-mail-bulk'></i></span><span>Kontakt</span></a></div><div class="navbar-item has-dropdown is-hoverable"><a class=navbar-link href=#>Deutsch (de)</a><div class="navbar-dropdown is-right"><a href=https://www.somethinglikegames.de/en/blog/2023/interest-management-with-multiplayersynchronizer/ lang=en class=navbar-item>English (en)</a></div></div></div></div></nav><section class=section><div class=container><div class=columns><div class="column is-one-fifth"><section id=site-sidebar class=is-hidden-mobile><section id=site-intro class="block has-text-centered"><a href=/de/><img src=/images/logo.webp class=circle width=128px height=128px alt=somethinglikegames.de></a><header></header><main><p>Mein persönlicher Blog über Spieleentwicklung als Einzelperson in Teilzeit</p></main><footer class="footer has-no-background"><span class=icon><a href=//github.com/somethinglikegames target=_blank rel=noopener title=GitHub class="fab fa-github"></a></span>
<span class=icon><a href=//youtube.com/@somethinglikegames target=_blank rel=noopener title=YouTube class="fab fa-youtube"></a></span>
<span id=cloaked-a89a87316d></span>
<script id=cloaked-script-a89a87316d>var cloakElement=document.getElementById("cloaked-a89a87316d"),link=document.createElement("a"),address="ed.semagekilgnihtemos@ofni".split("").reverse().join("");link.href="mailto:"+address,link.classList="far fa-envelope",link.title="email",cloakElement.parentNode.replaceChild(link,cloakElement)</script></footer></section><div class=block><hr></div><section id=categories class="block categories"><header><h1><a href=/de/categories><span class=icon-text><span class=icon><i class="fa fa-folders"></i></span><span>Kategorien</span></span></a></h1></header><ul><li><a href=/de/categories/tutorials/><span class=icon-text><span class=icon><i class="fa fa-folder"></i></span><span>tutorials</span></span><span class=count>9</span></a><li><a href=/de/categories/misc/><span class=icon-text><span class=icon><i class="fa fa-folder"></i></span><span>misc</span></span><span class=count>5</span></a><li><a href=/de/categories/news/><span class=icon-text><span class=icon><i class="fa fa-folder"></i></span><span>news</span></span><span class=count>2</span></a></li></ul></section></section></div><div class=column><article class=card><div class=card-image><a href=/de/blog/2023/interest-management-with-multiplayersynchronizer/ class=cover-image style="--bg-image:url('https://www.somethinglikegames.de/images/blog/2023/interest-management-with-multiplayersynchronizer/intro.webp')"><img class=stretchV src=https://www.somethinglikegames.de/images/blog/2023/interest-management-with-multiplayersynchronizer/intro.webp alt="Ein zweigeteiltes Bild, wo man auf der linken Seite ein Godot-Logo sieht, welches von anderen kleinen Godot-Logos mit Text zugespammt wird. Auf der rechten Seite sieht man abermals das Godot-Logo, dieses mal aber nur mit einem weiteren kleineren Logo, welches nach Hilfe fragt. Dieses kleinere Logo existiert zwar auch auf der linken Seite, geht aber bei all den anderen Logos unter."></a><div class=copyright><a href=https://github.com/godotengine/godot/blob/master/LOGO_LICENSE.md class=has-text-grey target=_blank rel="noopener nofollow noreferrer">Godot Engine Logo is licensed under CC-BY-4.0 international</a></div></div><header class=card-header><div class=card-header-title><h2 class=title><a href=/de/blog/2023/interest-management-with-multiplayersynchronizer/>Interest Management mit dem MultiplayerSynchronizer</a></h2></div></header><div class="card-content is-size-5 content"><div class=columns><div class=column><time datetime="2023-07-15 14:00:00 +0200 +0200">15.07.2023</time></div></div><div class=columns><div class=column><div class=tags><span class="tag is-info is-light"><a href=/de/categories/tutorials/ class=has-text-info><span class=icon-text><span class=icon><i class="fa fa-folder"></i></span>
<span>Tutorials</span></span></a></span>
<span class="tag is-link is-light"><a href=/de/tags/godot-engine/ class=has-text-link><span class=icon-text><span class=icon><i class="fa fa-tag"></i></span>
<span>Godot Engine</span></span></a></span>
<span class="tag is-link is-light"><a href=/de/tags/networking/ class=has-text-link><span class=icon-text><span class=icon><i class="fa fa-tag"></i></span>
<span>Networking</span></span></a></span></div></div></div><p>Nachdem wir im <a href=/de/tags/networking-tutorial/>Artikel zum Thema Scene Replication</a> bereits erste Erfahrungen mit dem <a href=https://docs.godotengine.org/en/stable/classes/class_multiplayersynchronizer.html target=_blank rel="noopener nofollow noreferrer"><code>MultiplayerSynchronizer</code></a> sammeln konnten, wollen wir unsere Erfahrungen damit in diesem Artikel weiter vertiefen. Denn der <code>MultiplayerSynchronizer</code> hat neben dem Synchronisierungsintervall noch andere Konfigurationsoptionen, mit dem sich interessante Dinge anstellen lassen.</p><p>Wir wollen uns in diesem Artikel mit dem Thema <em>Interest Management</em> beschäftigen. Darunter versteht man bei Netzwerkspielen, dass man den jeweiligen GameClients nur die Informationen über die anderen Spieler zukommen lässt, die der Spieler wirklich benötigt, um alles in seiner Umgebung wahrnehmen zu können. Dadurch wird versucht, die Netzwerkkommunikation pro verbundenem GameClient / Spieler möglichst klein zu halten. Als Nebeneffekt reduziert man bei wettbewerbsorientierten Spielen dadurch teilweise das Risiko von Wallhacks etc., da der GameClient im Idealfall nur noch das an Informationen bekommt und umsetzt, was der Spieler auch wahrnehmen (sehen bzw. hören) kann. Im Grunde genommen basiert es darauf, dass jede Spielfigur (mindestens) eine <em>Area of Interest</em> (<em>AoI</em>) hat, also einen Bereich um die Spielfigur herum. Wenn etwas innerhalb dieses Bereichs passiert, sich beispielsweise eine andere Spielfigur innerhalb des Bereichs bewegt, wird der GameClient darüber informiert, sodass er diese Bewegung auch anzeigen kann. Man könnte auch mit mehreren <em>AoI</em> arbeiten, um unterschiedliche Aspekte dadurch abzubilden, wenn z.B. der Spieler weiter sehen kann als hören, könnte man für jeden Sinn eine eigene <em>AoI</em> nutzen.</p><p>Zum Thema <em>Interest Management</em> wurde im Februar 2022 ein lesenswerter <a href=https://github.com/godotengine/godot-proposals/issues/3904 target=_blank rel="noopener nofollow noreferrer">Godot Proposal</a> veröffentlicht, den Fabio Alessandrelli dann im Rahmen von Godot 4 auch umgesetzt hat, indem er ihn in den <code>MultiplayerSynchronizer</code> integriert hat. Der zugehörige Pull-Request mit konkreter Implementierung ist <a href=https://github.com/godotengine/godot/pull/62961 target=_blank rel="noopener nofollow noreferrer">hier</a> zu finden. Aber schauen wir uns für ein besseres Verständnis die ganze Thematik doch einfach mal an einem konkreten Beispiel an.</p><p>Wir starten mit dem <a href=https://github.com/somethinglikegames/godot4-network-tutorial/tree/scene-replication target=_blank rel="noopener nofollow noreferrer">Beispielprojekt</a> aus dem <a href=/de/tags/networking-tutorial/>Artikel zum Thema Scene Replication</a>. Wenn ihr es nicht mehr haben solltet, findet ihr es im zugehörigen <a href=https://github.com/somethinglikegames/godot4-network-tutorial/tree/scene-replication target=_blank rel="noopener nofollow noreferrer">Github-Repository</a>. Ich habe mir gedacht, wir erweitern das Projekt so, dass die Spielfigur innerhalb der <code>Player</code>-Szene eine <em>AoI</em> in Form einer <code>Area3D</code> mit zugehörigem <code>CollisionShape3D</code> bekommt. Als Shape nehmen wir ein <code>CylinderShape3D</code> mit einem Radius von 5m, sodass unsere Spielfigur eine kreisrunde <em>AoI</em> mit 5m Radius hat. Dadurch sollten wir in unserem Beispiel den Effekt sehr gut bemerken können.</p><figure class="title is-6 is-centered"><img src=/images/blog/2023/interest-management-with-multiplayersynchronizer/player_scene.webp alt="Die Player-Szene inkl. 3D Ansicht"><figcaption><h4>Die Player-Szene inkl. 3D Ansicht</h4></figcaption></figure><figure class="title is-6 is-pulled-right"><img src=/images/blog/2023/interest-management-with-multiplayersynchronizer/server_synchronizer_inspector.webp alt="Konfiguration des ServerSynchronizers"><figcaption><h4>Konfiguration des ServerSynchronizers</h4></figcaption></figure><p>Bevor wir uns den zugehörigen Quellcode ansehen, müssen wir erst noch weitere Vorarbeit leisten. Die Idee ist ja, dass die <code>Area3D</code> unsere <em>AoI</em> ist. Damit sind alle Spielfiguren, die mit unserer <em>AoI</em> &ldquo;kollidieren&rdquo; von Interesse, alle anderen interessieren uns nicht. Für die Umsetzung müssen wir also die Signale <code>body_entered</code> und <code>body_exited</code> unserer <code>Area3D</code> mit unserem Player-Skript verknüpfen.</p><p>Zusätzlich müssen wir auch noch <em>Interest Management</em> im <code>MultiplayerSynchronizer</code> aktivieren. Dafür setzen wir das Property <code>public_visibility</code> des Synchronizers auf <code>false</code>. Das geht entweder skriptbasiert oder durch Entfernen des passenden Hakens über den Inspector, wie ich es hier im nebenstehenden Screenshot getan habe. Nun werden Sichtbarkeitseinstellungen, die man durch die Funktion <code>set_visibility_for()</code> machen kann, auch vom Synchronizer berücksichtigt.</p><p>Wie im untenstehenden Quellcode-Snippet zu erkennen ist, nutzen wir unsere verknüpften Signale der <code>Area3D</code>, um die Sichtbarkeit der jeweiligen Spielfiguren für den eigenen GameClient an- bzw. abzuschalten. Hier kommt uns zugute, dass wir die jeweiligen Spielfiguren mit der NetzwerkID des GameClients benannt haben. Hier in diesem Beispielprojekt verzichten wir der Einfachheit halber auf die Überprüfung ob es sich bei den kollidierenden <code>Node3D</code>-Objekten wirklich um andere Spielfiguren handelt. Normalerweise müsste man dies noch evaluieren oder besser <code>CollisionLayer</code> und <code>CollisionMask</code> so konfigurieren, dass Kollisionen nur durch andere Spielfiguren bzw. deren Handlungen ausgelöst werden können.</p><div class="message is-info"><div class=message-body>Die <code>Player</code>-Szene muss natürlich sowohl im WorldServer als auch im GameClient erweitert werden. Streng genommen reicht es aus, im GameClient ausschließlich das Property <code>public_visibility</code> vom <code>ServerSynchronizer</code> auf <code>false</code> zu stellen, da wir die Kollisionserkennung mit der <em>Area of Interest</em> ausschließlich auf dem Server machen. Daher ist die nachfolgende Skript-Erweiterung auch nur im WorldServer notwendig.</div></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span><span style=color:#66d9ef>func</span> _on_area_3d_body_entered(body: Node3D) <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span>	synchronizer<span style=color:#f92672>.</span>set_visibility_for(str(body<span style=color:#f92672>.</span>name)<span style=color:#f92672>.</span>to_int(), true)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span><span><span style=color:#66d9ef>func</span> _on_area_3d_body_exited(body: Node3D) <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span><span>	synchronizer<span style=color:#f92672>.</span>set_visibility_for(str(body<span style=color:#f92672>.</span>name)<span style=color:#f92672>.</span>to_int(), false)</span></span></code></pre></div><p>Sind diese Änderungen gemacht, sollte dem Testlauf eigentlich nichts mehr im Wege stehen. Ich hoffe, dass ich nichts vergessen habe und es auch soweit verständlich war. Ich finde die Godot-Umsetzung von <em>Interest Management</em> ziemlich elegant, da sie nicht nur funktional ist, sondern den Entwicklern die Freiheit lässt, selbst zu bestimmen, was ihre Sichtbarkeitskriterien für die jeweilige <em>Area of Interest</em> sind. Man muss nicht mit Kollisionen arbeiten, wie in diesem Beispiel, man ist komplett frei oder, um deutsche Politiker zu zitieren, &ldquo;technologieoffen&rdquo; 😉.</p><p>Mit dieser Technologie sollte es sogar möglich sein, ein System zu entwickeln, was ähnlich funktioniert wie das Layering bei World of Warcraft Classic. Da dort zum Start eines Addons oft viel mehr Spieler in bestimmten Gebieten sind als wenige Wochen nach dem Start, sind Spieler bestimmten Layern zugeordnet und sehen dann auch nur Spieler und NPC / Monster des selben Layers. Gruppen werden natürlich auf einem Layer zusammengelegt, sodass man die eigenen Gruppenmitglieder auch sehen und mit ihnen spielen kann.</p><p>Natürlich gibt es das fertige Projekt im üblichen <a href=https://github.com/somethinglikegames/godot4-network-tutorial/tree/interest-management target=_blank rel="noopener nofollow noreferrer">Github-Repository</a> zur eigenen Verwendung.</p></div></article><footer class=columns><div class="column has-text-left"><a href=/de/blog/2023/dtls-security-4.1/ class="button right"><span class=icon-text><span class=icon><i class="fa fa-angle-left"></i></span><span>DTLS-Security-Änderungen mit Godot 4.1</span></span></a></div><div class="column has-text-right"><a href=/de/blog/2023/material-synchronization/ class="button left"><span class=icon-text><span>Synchronisieren von Materialien mit dem MultiplayerSynchronizer</span><span class=icon><i class="fa fa-angle-right"></i></span></span></a></div></footer></div></div></div></section><footer class=footer><div class="container is-fluid has-text-centered"><ul class=socnet-icons><span class=icon><a href=//github.com/somethinglikegames target=_blank rel=noopener title=GitHub class="fab fa-github"></a></span>
<span class=icon><a href=//youtube.com/@somethinglikegames target=_blank rel=noopener title=YouTube class="fab fa-youtube"></a></span>
<span id=cloaked-ca9ac4d973></span>
<script id=cloaked-script-ca9ac4d973>var cloakElement=document.getElementById("cloaked-ca9ac4d973"),link=document.createElement("a"),address="ed.semagekilgnihtemos@ofni".split("").reverse().join("");link.href="mailto:"+address,link.classList="far fa-envelope",link.title="email",cloakElement.parentNode.replaceChild(link,cloakElement)</script></ul><p class=copyright><a href=https://www.somethinglikegames.de/de/legal_notice/>Impressum</a> &mdash;
<a href=https://www.somethinglikegames.de/de/privacy_policy/>Datenschutzerklärung</a> &mdash;
©2023-2024 Tobias Wink<br>Powered by <a href=https://gohugo.io/ title=0.109.0 target=_blank rel=noopener>Hugo</a></p></div></footer><script src=/js/navbar.min.js defer></script>
<script src=/js/copy-code-button.min.js defer></script></body></html>