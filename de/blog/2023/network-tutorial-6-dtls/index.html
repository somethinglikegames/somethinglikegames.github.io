<!doctype html><html lang=de><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/sass/main.min.2005bac08fea9f984d088cc097e64343345cd7ec419e82e7f12e4e0a21a791efd937755054c629c9ce1b911bec429935b92a6d1608219c876ba4b85c43037527.css integrity="sha512-IAW6wI/qn5hNCIzAl+ZDQzRc1+xBnoLn8S5OCiGnke/ZN3VQVMYpyc4bkRvsQpk1uSptFgghnIdrpLhcQwN1Jw=="><link rel=stylesheet href=/css/all.min.a0921f068fa9017ba1288b77420fbde17d89619431fab12b4d996e3e124af17337ac1b80bc2bb62458509e6033ace757405b5881b0c1d0db837dd64c8783b607.css integrity="sha512-oJIfBo+pAXuhKIt3Qg+94X2JYZQx+rErTZluPhJK8XM3rBuAvCu2JFhQnmAzrOdXQFtYgbDB0NuDfdZMh4O2Bw=="><title>Something Like Games | Netzwerktutorial 6: Verschlüsselte Verbindungen mit Hilfe von DTLS</title><link rel=apple-touch-icon sizes=57x57 href=/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/ms-icon-144x144.png"><meta name=theme-color content="#ffffff"><meta name=description content="In diesem Teil der Tutorialserie geht es darum die Netzwerkverbindungen mit Hilfe von DTLS zu verschlüsseln, sodass beispielsweise Passwörter sicher übertragen werden können."><meta itemprop=description content="In diesem Teil der Tutorialserie geht es darum die Netzwerkverbindungen mit Hilfe von DTLS zu verschlüsseln, sodass beispielsweise Passwörter sicher übertragen werden können."><meta name=twitter:description content="In diesem Teil der Tutorialserie geht es darum die Netzwerkverbindungen mit Hilfe von DTLS zu verschlüsseln, sodass beispielsweise Passwörter sicher übertragen werden können."><meta property="twitter:image" content="https://www.somethinglikegames.de/images/blog/2023/network-tutorial-6-dtls/intro.webp"><meta property="og:description" content="In diesem Teil der Tutorialserie geht es darum die Netzwerkverbindungen mit Hilfe von DTLS zu verschlüsseln, sodass beispielsweise Passwörter sicher übertragen werden können."><meta property="og:image" content="https://www.somethinglikegames.de/images/blog/2023/network-tutorial-6-dtls/intro.webp"></head><body><nav class="navbar is-light" role=navigation aria-label="main navigation"><div class=navbar-brand><a href=/de/ class=navbar-item><img src=/images/brand.webp alt="Something Like Games" width=128px height=28></a>
<a role=checkbox class=navbar-burger aria-label=menu aria-expanded=false data-target=navigation><span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span></a></div><div id=navigation class=navbar-menu><div class=navbar-end><div class=navbar-item><a href=/de/ class="nav link icon-text"><span class=icon><i class='fa fa-home'></i></span><span>Home</span></a></div><div class=navbar-item><a href=/de/contact/ class="nav link icon-text"><span class=icon><i class='fa fa-mail-bulk'></i></span><span>Kontakt</span></a></div><div class="navbar-item has-dropdown is-hoverable"><a class=navbar-link href=#>Deutsch (de)</a><div class="navbar-dropdown is-right"><a href=https://www.somethinglikegames.de/en/blog/2023/network-tutorial-6-dtls/ lang=en class=navbar-item>English (en)</a></div></div></div></div></nav><section class=section><div class=container><div class=columns><div class="column is-one-fifth"><section id=site-sidebar class=is-hidden-mobile><section id=site-intro class="block has-text-centered"><a href=/de/><img src=/images/logo.webp class=circle width=128px height=128px alt=somethinglikegames.de></a><header></header><main><p>Mein persönlicher Blog über Spieleentwicklung als Einzelperson in Teilzeit</p></main><footer class="footer has-no-background"><span class=icon><a href=//github.com/somethinglikegames target=_blank rel=noopener title=GitHub class="fab fa-github"></a></span>
<span class=icon><a href=//youtube.com/@somethinglikegames target=_blank rel=noopener title=YouTube class="fab fa-youtube"></a></span>
<span id=cloaked-0592ba4f0c></span>
<script id=cloaked-script-0592ba4f0c>var cloakElement=document.getElementById("cloaked-0592ba4f0c"),link=document.createElement("a"),address="ed.semagekilgnihtemos@ofni".split("").reverse().join("");link.href="mailto:"+address,link.classList="far fa-envelope",link.title="email",cloakElement.parentNode.replaceChild(link,cloakElement)</script></footer></section><div class=block><hr></div><section id=categories class="block categories"><header><h1><a href=/de/categories><span class=icon-text><span class=icon><i class="fa fa-folders"></i></span><span>Kategorien</span></span></a></h1></header><ul><li><a href=/de/categories/tutorials/><span class=icon-text><span class=icon><i class="fa fa-folder"></i></span><span>tutorials</span></span><span class=count>10</span></a><li><a href=/de/categories/misc/><span class=icon-text><span class=icon><i class="fa fa-folder"></i></span><span>misc</span></span><span class=count>5</span></a><li><a href=/de/categories/news/><span class=icon-text><span class=icon><i class="fa fa-folder"></i></span><span>news</span></span><span class=count>2</span></a></li></ul></section></section></div><div class=column><article class=card><div class=card-image><a href=/de/blog/2023/network-tutorial-6-dtls/ class=cover-image style="--bg-image:url('https://www.somethinglikegames.de/images/blog/2023/network-tutorial-6-dtls/intro.webp')"><img class=stretchV src=https://www.somethinglikegames.de/images/blog/2023/network-tutorial-6-dtls/intro.webp alt="two computers connected via a cryptographically secured wired connection, landscape, comic style"></a><div class=copyright><a href=https://huggingface.co/spaces/stabilityai/stable-diffusion class=has-text-grey target=_blank rel="noopener nofollow noreferrer">Generated with Stable Diffusion 2.1</a></div></div><header class=card-header><div class=card-header-title><h2 class="title is-2"><a href=/de/blog/2023/network-tutorial-6-dtls/>Netzwerktutorial 6: Verschlüsselte Verbindungen mit Hilfe von DTLS</a></h2></div></header><div class="card-content is-size-5 content"><div class=columns><div class=column><time datetime="2023-04-09 11:45:00 +0100 +0100">09.04.2023</time></div></div><div class=columns><div class=column><div class=tags><span class="tag is-info is-light"><a href=/de/categories/tutorials/ class=has-text-info><span class=icon-text><span class=icon><i class="fa fa-folder"></i></span>
<span>Tutorials</span></span></a></span>
<span class="tag is-link is-light"><a href=/de/tags/networking-tutorial/ class=has-text-link><span class=icon-text><span class=icon><i class="fa fa-tag"></i></span>
<span>Networking-Tutorial</span></span></a></span>
<span class="tag is-link is-light"><a href=/de/tags/godot-engine/ class=has-text-link><span class=icon-text><span class=icon><i class="fa fa-tag"></i></span>
<span>Godot Engine</span></span></a></span>
<span class="tag is-link is-light"><a href=/de/tags/networking/ class=has-text-link><span class=icon-text><span class=icon><i class="fa fa-tag"></i></span>
<span>Networking</span></span></a></span>
<span class="tag is-link is-light"><a href=/de/tags/security/ class=has-text-link><span class=icon-text><span class=icon><i class="fa fa-tag"></i></span>
<span>Security</span></span></a></span></div></div></div><p>Der Quellcode zu den Artikeln ist in diesem <a href=https://github.com/somethinglikegames/godot4-network-tutorial target=_blank rel="noopener nofollow noreferrer">GitHub Repository</a> zu finden. Die folgende Liste zeigt alle bislang erschienenen Artikel dieser Serie:</p><ol><li><a href=/de/blog/2023/network-tutorial-1-overview/>Netzwerktutorial 1: Allgemeines und Übersicht</a></li><li><a href=/de/blog/2023/network-tutorial-2-walking-skeleton/>Netzwerktutorial 2: Das "gehende Skelett"</a></li><li><a href=/de/blog/2023/network-tutorial-3-login-1/>Netzwerktutorial 3: Login 1 - Der Game-Client</a></li><li><a href=/de/blog/2023/network-tutorial-4-login-2/>Netzwerktutorial 4: Login 2 - Gateway- und Authentication-Server</a></li><li><a href=/de/blog/2023/network-tutorial-5-login-3/>Netzwerktutorial 5: Login 3 - World-Server</a></li><li>Netzwerktutorial 6: Verschlüsselte Verbindungen mit Hilfe von DTLS</li></ol><p>Im <a href=/de/blog/2023/network-tutorial-5-login-3/>letzten Artikel</a> haben wir den Loginvorgang fertiggestellt. Vor dessen Anwendung in der Praxis sollten wir aber zuerst unsere Netzwerkverbindungen absichern. Das Mindeste, was man tun sollte und, wenn ich die DSGVO richtig verstehe, auch tun muss, ist, Benutzerpasswörter nur mit Hilfe von verschlüsselten Kanälen im Internet zu übertragen. Im Idealfall weitet man die verschlüsselte Kommunikation auf die gesamte Infrastruktur aus. Darum soll es also in diesem Artikel gehen: Wir verschlüsseln die Netzwerkverbindungen zwischen unseren Servern und Clients.</p><p>Um zu beweisen, dass aktuell die Passwörter wirklich als Klartext übertragen werden, habe ich im nachfolgenden Bild mit Hilfe von <a href=https://www.wireshark.org/ target=_blank rel="noopener nofollow noreferrer">Wireshark</a> ein Login-Paket zwischen Client und Gateway-Server abgefangen. Wie man im rechten Teil des Ausschnitts erkennen kann, wurde der Login mit dem Benutzernamen &ldquo;my_username&rdquo; und dem Passwort &ldquo;my_secret_password&rdquo; versucht.</p><figure class="title is-6 center"><img src=/images/blog/2023/network-tutorial-6-dtls/wireshark_no_dtls.webp alt="Unverschlüsselter Login"><figcaption><h4>Netzwerkdump mit unverschlüsselter Passwortübertragung</h4></figcaption></figure><p>Aber selbst wenn der Schutz der eigenen Benutzer nicht Grund genug wäre, gibt es ebenfalls einen weiteren guten Grund: Die Absicherung gegen Proxy-Angriffe. Damit sind alle Angriffe bzw. Betrugsversuche gemeint, die mit Hilfe von Netzwerkproxies umgesetzt werden können. Dabei analysiert der Netzwerkproxy die Netzwerkpakete zwischen Spielclient und -server. Sollte der Proxy etwas erkannt haben, bspw. einen Gegner, könnte er die Netzwerkpakete des Spielclients so verändern, dass der Spielserver glaubt, der Nutzer des Spielclients würde den Gegner angreifen. Es handelt sich dabei um eine Art Machine-in-the-middle Attacke, die vom Nutzer des Spielclients selbst initiiert und gewünscht wird, um sich bspw. übermenschliche Reflexe zu ergaunern. Diese Art von Angriff funktioniert aber nur, wenn die Netzwerkverbindungen unverschlüsselt sind.</p><h3 class="title is-4" id=dtls>DTLS</h3><p>DTLS steht für Datagram Transport Layer Security und ist vereinfacht gesagt TLS für UDP. TLS wiederum sollte mittlerweile jeder von seinem Browser kennen, denn wenn die Adresszeile mit <code>https</code> beginnt bzw. dort ein Schloss angezeigt wird, ist die Verbindung mit Hilfe von TLS verschlüsselt. Man kann sich TLS so vorstellen, als ob zwischen Client und Server ein Tunnel etabliert wird, alle (Klartext-)Daten fließen durch den Tunnel und Außenstehende sehen beim Blick zum Tunnel nur Kauderwelsch, da die Tunnelwände alle Daten verschlüsseln. Das heißt, sobald dieser Tunnel aufgebaut ist, kommunizieren Client und Server für sich weiterhin unverschlüsselt, aber alle Mithörenden bekommen nur die verschlüsselte Kommunikation mit.</p><p>Generell werden neue Versionen von DTLS immer einige Jahre nach der jeweiligen TLS-Version spezifiziert. Welche Version konkret von Godot eingesetzt wird, konnte ich zwar noch nicht herausfinden, aber sobald ich es weiß, werde ich es mitteilen. Generell benutzt Godot 4.0.2 für (D)TLS intern die Bibliothek <a href=https://github.com/godotengine/godot/tree/4.0.2-stable/thirdparty#mbedtls target=_blank rel="noopener nofollow noreferrer">mbedtls 2.18.2</a>, welche DTLS 1.0 und 1.2 unterstützt.</p><div class="message is-info"><div class=message-body>Die Version 1.1 von DTLS wurde nie veröffentlicht, um sich ab Version 1.2 dem Versionierungsschema von TLS anzugleichen. DTLS 1.0 basiert auf TLS 1.1 und DTLS 1.2 auf TLS 1.2.</div></div><h3 class="title is-4" id=erstellen-der-zertifikate>Erstellen der Zertifikate</h3><p>(D)TLS setzt bei der Verschlüsselung <a href=https://de.wikipedia.org/wiki/Digitales_Zertifikat#Public-Key-Zertifikate target=_blank rel="noopener nofollow noreferrer">digitale Public-Key-Zertifikate</a> ein. Ohne jetzt weiter auf <a href=https://de.wikipedia.org/wiki/X.509 target=_blank rel="noopener nofollow noreferrer">X.509</a> einzugehen, ist ein solches Public-Key-Zertifikat fast wie ein RSA-Schlüsselpaar, welches wir bereits bei der <a href=/de/blog/2023/network-tutorial-4-login-2/>Tokenerzeugung</a> eingesetzt haben, nur dass das Public-Key-Zertifikat neben dem Public-Key noch weitere Informationen enthält, wie bspw. Aussteller, Gültigkeitszeitraum und Angaben zum Inhaber.</p><p>Im WWW ist es üblich, TLS-Zertifikate zu nutzen, die von &ldquo;anerkannten&rdquo; <a href=https://de.wikipedia.org/wiki/Zertifizierungsstelle target=_blank rel="noopener nofollow noreferrer">Zertifizierungsstellen</a> (CAs = Certificate Authorities) ausgestellt wurden. Dabei wird das eigentliche Zertifikat durch eine Zertifizierungsstelle signiert, um die Vertraulichkeit zu erhöhen. So ergeben sich in der Praxis dann teilweise Zertifikatsketten, weil das Zertifikat, mit dem die Zertifizierungsstelle signiert hat, wiederum von einer weiteren Zertifizierungsstelle signiert wurde. &ldquo;Anerkannt&rdquo; bedeutet, dass die Software, in der Praxis in der Regel der Browser, dieser CA bzw. der &ldquo;übergeordneten&rdquo; CA vertraut. Dafür nutzt Firefox bspw. eine eigene Datenbank, während sich die meisten anderen Browser auf die Datenbank des Betriebssystem verlassen. Dank <a href=https://letsencrypt.org/de/ target=_blank rel="noopener nofollow noreferrer">Let&rsquo;s Encrypt</a> ist dies auch kostenlos und bequem möglich. Ein Beispiel einer solchen Zertifikatskette sieht man bspw. auf diesem <a href="https://www.ssllabs.com/ssltest/analyze.html?d=www.somethinglikegames.de&s=2606%3a50c0%3a8001%3a0%3a0%3a0%3a0%3a153&latest" target=_blank rel="noopener nofollow noreferrer">SSL Report</a> von Qualys SSL Labs, wo ein Server, der diese Website ausliefert, auf bekannte TLS Sicherheitslücken getestet wurde.</p><p>Solange wir die Dinge nur lokal zum Testen nutzen, können wir uns den Weg über Zertifizierungsstellen sparen und stattdessen &ldquo;self-signed&rdquo; Zertifikate nutzen, sie also selbst signieren. Es gibt viele Wege, um self-signed Zertifikate zu erzeugen. Unter Linux bietet sich bspw. openssl an:</p><pre tabindex=0><code>openssl req -x509 -newkey rsa:4096 -sha256 -days 365 -nodes \
			-keyout authentication_server.key \
			-out authentication_server.crt
</code></pre><p>Dadurch erzeugen wir ein X.509-Zertifikat mit einem 4096-bit RSA-Schlüssel und SHA256-Hashwerten, welches 365 Tage gültig ist und keine Passphrase für den Schlüssel nutzt (<code>-nodes</code>). Der private Schlüssel soll <code>authentication_server.key</code> heißen und das Zertifikat <code>authentication_server.crt</code>. Für die Erzeugung werden auch noch einige allgemeine Angaben abgefragt, die für reguläre Zertifikate notwendig sind. Da wir diese Zertifikate aktuell nur lokal zum Testen nutzen wollen, sind die Angaben vorerst irrelevant.</p><p>Alternativ kann man sich auch selbst eine kleine Godot-Anwendung erstellen, die Zertifikate betriebssystemunabhängig erzeugt. Ein rudimentäres Beispiel dazu findet ihr mit Godot 3.2.3 <a href="https://youtu.be/gcopx40pwvY?list=PLZ-54sd-DMAKU8Neo5KsVmq8KtoDkfi4s&t=118" target=_blank rel="noopener nofollow noreferrer">hier im Tutorial</a> von Game Development Center aka Stefan.</p><p>Insgesamt benötigen wir Zertifikate für den Authentication-, Gateway- und World-Server.</p><h3 class="title is-4" id=aktivieren-von-dtls-in-godot>Aktivieren von DTLS in Godot</h3><p>Nachdem wir nun alle notwendigen Zertifikate haben, müssen wir DTLS &ldquo;nur&rdquo; noch in unseren Godot-Projekten aktivieren. Um diesen Artikel nicht unnötig in die Länge zu ziehen und euch dadurch zu langweilen, werde ich es beispielhaft für einen Server und einen Client zeigen. Als Server nehme ich den Authentication-Server und als Client fungiert passenderweise der Gateway-Server. Da wir ja bislang den Aufbau der Projekte möglichst identisch gestaltet haben, sollten sich die notwendigen Schritte problemlos auf die anderen Projekte übertragen lassen, und zur Not kann man auch im <a href=https://github.com/somethinglikegames/godot4-network-tutorial target=_blank rel="noopener nofollow noreferrer">GitHub Repository</a> nachschauen.</p><h4 class="title is-5" id=aktivieren-von-dtls-auf-dem-server-authentication_serverscenesnetworkauthentication_servergd>Aktivieren von DTLS auf dem &ldquo;Server&rdquo; (authentication_server/scenes/network/authentication_server.gd)</h4><p>Ich habe sowohl das Zertifikat als auch den zugehörigen privaten Schlüssel in das <code>crypto</code> Verzeichnis abgelegt, wo sich im Fall des Authentication-Servers bereits das RSA-Schlüsselpaar für den Token befindet. Das Verzeichnis wurde auch bereits aus Sicherheitsgründen als Ausnahme in die <code>.gitignore</code> Datei eingefügt, da meiner Meinung nach grundsätzlich keine Zertifikate und Schlüssel in ein Versionsverwaltungssystem gehören.</p><p>Anschließend erweitern wir das Server-Skript, also in diesem beispielhaften Fall: <code>authentication_server/scenes/network/authentication_server.gd</code>. Zuerst laden wir unseren privaten Schlüssel und das Zertifikat:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#66d9ef>const</span> dtls_key :<span style=color:#f92672>=</span> preload(<span style=color:#e6db74>&#34;res://crypto/authentication_server.key&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span><span style=color:#66d9ef>const</span> dtls_cert :<span style=color:#f92672>=</span> preload(<span style=color:#e6db74>&#34;res://crypto/authentication_server.crt&#34;</span>)</span></span></code></pre></div><p>Anschließend müssen wir unsere <code>startup()</code> Funktion noch minimal erweitern, um DTLS zu aktivieren (Zeile 31). Damit die einzelne notwendige Zeile nicht ganz ohne Kontext aufgeführt wird, habe ich auch noch ein paar Zeilen davor und dahinter mit hineinkopiert, auch wenn diese Zeilen aus früheren Artikeln stammen.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span><span style=color:#66d9ef>func</span> startup() <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>	<span style=color:#66d9ef>var</span> network :<span style=color:#f92672>=</span> ENetMultiplayerPeer<span style=color:#f92672>.</span>new()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>	<span style=color:#66d9ef>var</span> ret :<span style=color:#f92672>=</span> network<span style=color:#f92672>.</span>create_server(network_port, max_clients)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>	<span style=color:#66d9ef>if</span> ret <span style=color:#f92672>==</span> OK:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>		network<span style=color:#f92672>.</span>host<span style=color:#f92672>.</span>dtls_server_setup(TLSOptions<span style=color:#f92672>.</span>server(dtls_key, dtls_cert))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>		multiplayer<span style=color:#f92672>.</span>server_relay <span style=color:#f92672>=</span> false
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>		multiplayer<span style=color:#f92672>.</span>set_multiplayer_peer(network)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>		<span style=color:#f92672>...</span></span></span></code></pre></div><p>DTLS wird auf Ebene der <code>ENetConnection</code> aktiviert, welche wir über das <code>host</code> Attribut unseres <code>ENetMultiplayerPeer</code> erreichen. Als Parameter werden <code>TLSOptions</code> übergeben, und da diese Optionen nicht direkt instanziiert werden können, gibt es passende statische Factory-Methoden, die die korrekte Instanziierung für uns übernehmen. Da wir hier DTLS auf dem Server aktivieren wollen, wählen wir natürlich die statische Methode <code>server()</code>.</p><h4 class="title is-5" id=aktivieren-von-dtls-auf-dem-client-gateway_serverscenesnetworkauthentication_servergd>Aktivieren von DTLS auf dem &ldquo;Client&rdquo; (gateway_server/scenes/network/authentication_server.gd)</h4><p>Beim Gateway-Server als DTLS-Client des Authentication-Servers müssen wir ebenfalls unsere <code>startup()</code> Funktion erweitern, um DTLS zu aktivieren (Zeile 18). Auch hier habe ich ein paar Zeilen davor und dahinter hinzugefügt, damit der Kontext besser ersichtlich wird:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#66d9ef>func</span> startup() <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>	print(<span style=color:#e6db74>&#34;Connecting to </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>:</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> [authentication_server, authentication_server_port])
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>	<span style=color:#66d9ef>var</span> ret <span style=color:#f92672>=</span> network<span style=color:#f92672>.</span>create_client(authentication_server, authentication_server_port)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>	<span style=color:#66d9ef>var</span> _hash :<span style=color:#f92672>=</span> _crypto<span style=color:#f92672>.</span>hmac_digest(HashingContext<span style=color:#f92672>.</span>HASH_SHA256, shared_secret,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>			Time<span style=color:#f92672>.</span>get_date_string_from_system(true)<span style=color:#f92672>.</span>to_utf8_buffer())
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>	<span style=color:#66d9ef>if</span> ret <span style=color:#f92672>==</span> OK:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>		network<span style=color:#f92672>.</span>host<span style=color:#f92672>.</span>dtls_client_setup(<span style=color:#e6db74>&#34;localhost&#34;</span>, TLSOptions<span style=color:#f92672>.</span>client_unsafe())
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>		multiplayer<span style=color:#f92672>.</span>multiplayer_peer <span style=color:#f92672>=</span> network
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>		<span style=color:#f92672>...</span></span></span></code></pre></div><p>Es gilt auch auf dem Client, dass DTLS auf Ebene der <code>ENetConnection</code> aktiviert wird, welche wir über das <code>host</code> Attribut unseres <code>ENetMultiplayerPeer</code> erreichen. Als erster Parameter von <code>dtls_client_setup()</code> wird der Hostname des Servers übergeben. Da ich in dieser Tutorialserie alles lokal auf einem einzelnen PC laufen lasse, ist mein Hostname &ldquo;localhost&rdquo;. Als zweiter Parameter wird ebenfalls <code>TLSOptions</code> übergeben, nur dass wir dieses Mal die statische Funktion <code>client_unsafe()</code> verwenden. Die Funktion <code>client_unsafe()</code> zur Initialisierung von <code>TLSOptions</code> sollte ausschließlich für Testzwecke verwendet werden, da hierdurch die Zertifikatsprüfung deaktiviert wird.</p><p>In einem produktiven Szenario würde man stattdessen die Funktion <code>client()</code> nutzen und entweder ein Zertifikat einer &ldquo;anerkannten&rdquo; Zertifizierungsstelle verwenden oder aber eine eigene CA erstellen, deren Zertifikatskette man bei der Funktion als Parameter übergeben kann. Hierbei ist auch noch wichtig zu erwähnen, dass man die Zertifikate rechtzeitig erneuern und ggf. auch Clients aktualisieren muss, falls sich etwas in der Zertifikatskette geändert hat.</p><h3 class="title is-4" id=überprüfen-der-verschlüsselten-verbindung>Überprüfen der verschlüsselten Verbindung</h3><p>Nachdem wir die Schritte für alle unsere Godot-Projekte ausgeführt haben, sollte die Kommunikation weiterhin wie gewohnt funktionieren, und man sollte eigentlich gar nicht merken, dass unsere Verbindungen nun verschlüsselt sind. Um aber zu prüfen, ob die Verbindung nun wirklich verschlüsselt ist, habe ich meinen anfänglichen Test wiederholt und die Kommunikation zwischen Game-Client und Gateway-Server mit Hilfe von Wireshark mitgeschnitten. Wie lauteten dieses Mal die Logindaten?</p><figure class="title is-6 center"><img src=/images/blog/2023/network-tutorial-6-dtls/wireshark_dtls.webp alt="Verschlüsselter Login"><figcaption><h4>Netzwerkdump mit verschlüsselter Passwortübertragung</h4></figcaption></figure></div></article><footer class=columns><div class="column has-text-left"><a href=/de/blog/2023/network-tutorial-5-login-3/ class="button right"><span class=icon-text><span class=icon><i class="fa fa-angle-left"></i></span><span>Netzwerktutorial 5: Login 3 - World-Server</span></span></a></div><div class="column has-text-right"><a href=/de/blog/2023/a-small-interim-report/ class="button left"><span class=icon-text><span>Eine kleine Zwischenmeldung</span><span class=icon><i class="fa fa-angle-right"></i></span></span></a></div></footer></div></div></div></section><footer class=footer><div class="container is-fluid has-text-centered"><ul class=socnet-icons><span class=icon><a href=//github.com/somethinglikegames target=_blank rel=noopener title=GitHub class="fab fa-github"></a></span>
<span class=icon><a href=//youtube.com/@somethinglikegames target=_blank rel=noopener title=YouTube class="fab fa-youtube"></a></span>
<span id=cloaked-ca8a023f21></span>
<script id=cloaked-script-ca8a023f21>var cloakElement=document.getElementById("cloaked-ca8a023f21"),link=document.createElement("a"),address="ed.semagekilgnihtemos@ofni".split("").reverse().join("");link.href="mailto:"+address,link.classList="far fa-envelope",link.title="email",cloakElement.parentNode.replaceChild(link,cloakElement)</script></ul><p class=copyright><a href=https://www.somethinglikegames.de/de/legal_notice/>Impressum</a> &mdash;
<a href=https://www.somethinglikegames.de/de/privacy_policy/>Datenschutzerklärung</a> &mdash;
©2023-2024 Tobias Wink<br>Powered by <a href=https://gohugo.io/ title=0.109.0 target=_blank rel=noopener>Hugo</a></p></div></footer><script src=/js/navbar.min.js defer></script>
<script src=/js/copy-code-button.min.js defer></script></body></html>