<!doctype html><html lang=de><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/sass/main.min.2005bac08fea9f984d088cc097e64343345cd7ec419e82e7f12e4e0a21a791efd937755054c629c9ce1b911bec429935b92a6d1608219c876ba4b85c43037527.css integrity="sha512-IAW6wI/qn5hNCIzAl+ZDQzRc1+xBnoLn8S5OCiGnke/ZN3VQVMYpyc4bkRvsQpk1uSptFgghnIdrpLhcQwN1Jw=="><link rel=stylesheet href=/css/all.min.a0921f068fa9017ba1288b77420fbde17d89619431fab12b4d996e3e124af17337ac1b80bc2bb62458509e6033ace757405b5881b0c1d0db837dd64c8783b607.css integrity="sha512-oJIfBo+pAXuhKIt3Qg+94X2JYZQx+rErTZluPhJK8XM3rBuAvCu2JFhQnmAzrOdXQFtYgbDB0NuDfdZMh4O2Bw=="><title>Something Like Games | Synchronisieren von Materialien mit dem MultiplayerSynchronizer</title><link rel=apple-touch-icon sizes=57x57 href=/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/ms-icon-144x144.png"><meta name=theme-color content="#ffffff"><meta name=description content="In diesem Tutorial geht es darum Möglichkeiten aufzuzeigen, wie man komplexere Werte synchronisieren kann."><meta itemprop=description content="In diesem Tutorial geht es darum Möglichkeiten aufzuzeigen, wie man komplexere Werte synchronisieren kann."><meta name=twitter:description content="In diesem Tutorial geht es darum Möglichkeiten aufzuzeigen, wie man komplexere Werte synchronisieren kann."><meta property="twitter:image" content="https://www.somethinglikegames.de/images/blog/2023/material-synchronization/intro.webp"><meta property="og:description" content="In diesem Tutorial geht es darum Möglichkeiten aufzuzeigen, wie man komplexere Werte synchronisieren kann."><meta property="og:image" content="https://www.somethinglikegames.de/images/blog/2023/material-synchronization/intro.webp"></head><body><nav class="navbar is-light" role=navigation aria-label="main navigation"><div class=navbar-brand><a href=/de/ class=navbar-item><img src=/images/brand.webp alt="Something Like Games" width=128px height=28></a>
<a role=checkbox class=navbar-burger aria-label=menu aria-expanded=false data-target=navigation><span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span></a></div><div id=navigation class=navbar-menu><div class=navbar-end><div class=navbar-item><a href=/de/ class="nav link icon-text"><span class=icon><i class='fa fa-home'></i></span><span>Home</span></a></div><div class=navbar-item><a href=/de/contact/ class="nav link icon-text"><span class=icon><i class='fa fa-mail-bulk'></i></span><span>Kontakt</span></a></div><div class="navbar-item has-dropdown is-hoverable"><a class=navbar-link href=#>Deutsch (de)</a><div class="navbar-dropdown is-right"><a href=https://www.somethinglikegames.de/en/blog/2023/material-synchronization/ lang=en class=navbar-item>English (en)</a></div></div></div></div></nav><section class=section><div class=container><div class=columns><div class="column is-one-fifth"><section id=site-sidebar class=is-hidden-mobile><section id=site-intro class="block has-text-centered"><a href=/de/><img src=/images/logo.webp class=circle width=128px height=128px alt=somethinglikegames.de></a><header></header><main><p>Mein persönlicher Blog über Spieleentwicklung als Einzelperson in Teilzeit</p></main><footer class="footer has-no-background"><span class=icon><a href=//github.com/somethinglikegames target=_blank rel=noopener title=GitHub class="fab fa-github"></a></span>
<span class=icon><a href=//youtube.com/@somethinglikegames target=_blank rel=noopener title=YouTube class="fab fa-youtube"></a></span>
<span id=cloaked-a490fdd25d></span>
<script id=cloaked-script-a490fdd25d>var cloakElement=document.getElementById("cloaked-a490fdd25d"),link=document.createElement("a"),address="ed.semagekilgnihtemos@ofni".split("").reverse().join("");link.href="mailto:"+address,link.classList="far fa-envelope",link.title="email",cloakElement.parentNode.replaceChild(link,cloakElement)</script></footer></section><div class=block><hr></div><section id=categories class="block categories"><header><h1><a href=/de/categories><span class=icon-text><span class=icon><i class="fa fa-folders"></i></span><span>Kategorien</span></span></a></h1></header><ul><li><a href=/de/categories/tutorials/><span class=icon-text><span class=icon><i class="fa fa-folder"></i></span><span>tutorials</span></span><span class=count>10</span></a><li><a href=/de/categories/misc/><span class=icon-text><span class=icon><i class="fa fa-folder"></i></span><span>misc</span></span><span class=count>5</span></a><li><a href=/de/categories/news/><span class=icon-text><span class=icon><i class="fa fa-folder"></i></span><span>news</span></span><span class=count>2</span></a></li></ul></section></section></div><div class=column><article class=card><div class=card-image><a href=/de/blog/2023/material-synchronization/ class=cover-image style="--bg-image:url('https://www.somethinglikegames.de/images/blog/2023/material-synchronization/intro.webp')"><img class=stretchV src=https://www.somethinglikegames.de/images/blog/2023/material-synchronization/intro.webp alt="Ein Verlauf wie das Godot-Logo die Farbe ändert."></a><div class=copyright><a href=https://github.com/godotengine/godot/blob/master/LOGO_LICENSE.md class=has-text-grey target=_blank rel="noopener nofollow noreferrer">Godot Engine Logo is licensed under CC-BY-4.0 international</a></div></div><header class=card-header><div class=card-header-title><h2 class="title is-2"><a href=/de/blog/2023/material-synchronization/>Synchronisieren von Materialien mit dem MultiplayerSynchronizer</a></h2></div></header><div class="card-content is-size-5 content"><div class=columns><div class=column><time datetime="2023-08-05 12:00:00 +0200 +0200">05.08.2023</time></div></div><div class=columns><div class=column><div class=tags><span class="tag is-info is-light"><a href=/de/categories/tutorials/ class=has-text-info><span class=icon-text><span class=icon><i class="fa fa-folder"></i></span>
<span>Tutorials</span></span></a></span>
<span class="tag is-link is-light"><a href=/de/tags/godot-engine/ class=has-text-link><span class=icon-text><span class=icon><i class="fa fa-tag"></i></span>
<span>Godot Engine</span></span></a></span>
<span class="tag is-link is-light"><a href=/de/tags/networking/ class=has-text-link><span class=icon-text><span class=icon><i class="fa fa-tag"></i></span>
<span>Networking</span></span></a></span></div></div></div><p>Vor einigen Tagen wurde im offiziellen Godot Discord-Server darüber diskutiert, wie man es schaffen kann, Materialien über das Netzwerk zu synchronisieren. Um das Problem etwas besser nachvollziehen zu können, sollte ich vielleicht zuerst einmal erklären, dass man nicht jeden Datentyp per RPC oder <code>MultiplayerSynchronizer</code> über das Netzwerk transferien kann, sondern nur skalare Datentypen. Zu den skalaren Datentypen zählen generell alle Datentypen, die nur einen einzelnen Wert beinhalten können, wie <code>int</code>, <code>float</code>, <code>Bool</code>, <code>String</code> oder <code>StringName</code>.</p><p>Generell nennt man das ganze Themengebiet Serialisierung und dabei geht es darum, die Variablen oder teilweise auch Objekte aus dem Arbeitsspeicher auszulesen und so zu transformieren, dass man daraus erneut Variablen / Objekte des ursprünglichen Typs mit identischem Inhalt erzeugen kann. Daher ist Serialisierung auch nicht nur für den Netzwerktransfer relevant, sondern wird auch benötigt, wenn man bspw. den Spielstand speichern möchte.</p><div class="message is-warning"><div class=message-body>Meine Aussage zu den &ldquo;erlaubten&rdquo; Datentypen ist nicht ganz richtig. Es gibt die Funktionen <a href=https://docs.godotengine.org/en/stable/classes/class_@globalscope.html#class-globalscope-method-var-to-bytes-with-objects target=_blank rel="noopener nofollow noreferrer"><code>PackedByteArray var_to_bytes_with_objects(Variant variable)</code></a> und <a href=https://docs.godotengine.org/en/stable/classes/class_@globalscope.html#class-globalscope-method-bytes-to-var-with-objects target=_blank rel="noopener nofollow noreferrer"><code>Variant bytes_to_var_with_objects(PackedByteArray bytes)</code></a>, mit deren Hilfe man jedes Objekt serialisieren und deserialisieren kann.<br>⚠️ In der Praxis sollte man damit aber extrem vorsichtig sein, da man dadurch auch ausführbaren Code übertragen kann, was ein extrem hohes Sicherheitsrisiko darstellt und daher in der Praxis nicht genutzt werden sollte, selbst wenn man wirklich weiß, was man tut.</div></div><h3 class="title is-4" id=die-idee>Die Idee</h3><p>Direkt nach dem Lesen der Frage hatte ich auch bereits eine Idee, wie man das Problem lösen kann. Aber um wirklich sicherzugehen, dass diese Idee funktioniert, habe ich das <a href=https://github.com/somethinglikegames/godot4-network-tutorial/tree/interest-management target=_blank rel="noopener nofollow noreferrer">altbekannte Tutorialprojekt</a> so erweitert, dass die Clients mit der Tabulator-Taste zwischen drei verschiedenen Materialien wechseln können und alle anderen Clients diesen Materialienwechsel ebenfalls synchronisiert bekommen.</p><p>Ganz genau genommen funktioniert es in der Praxis dann doch ein klein wenig anders:</p><ol><li>Es gibt ein Enum <code>SupportedColors</code>, welches für alle Spielermaterialien einen Wert bereithält. (<code>player.gd</code>)</li><li>Es gibt ein Dictionary <code>colorToMaterial</code>, welches alle Enum-Werte auf die zugehörigen gespeicherten Materialien abbildet. (<code>player.gd</code>)</li><li>Die Spielfigur erhält ein Property <code>currentColor</code> vom Typ <code>SupportedColors</code>,<ol><li>welches immer den Enum-Wert des aktuell angezeigten Materials enthält. (<code>player.gd</code>)</li><li>welches im Setter, also wenn die Farbe geändert wird, das Material des Spielfigur-Meshs durch das Material aus <code>colorToMaterial</code> austauscht. (<code>player.gd</code>)</li><li>welches mit Hilfe von unserem MultiplayerSynchronizer <code>ServerSynchronizer</code> synchronisiert wird (Spawn, Watch). (<code>player.tscn</code>)</li></ol></li><li>Wenn in einem der Clients die Tabulator-Taste betätigt wird, wird dies mit Hilfe eines RPCs an den Server signalisiert. (<code>player_input.gd</code>)</li><li>Sobald der Server den Materialänderungswunsch empfängt, ändert er den Wert von <code>currentColor</code>. Dies wird an alle Clients in Reichweite synchronisiert, wodurch die jeweiligen Setter aufgerufen werden, was in der Materialänderung des Spielfigur-Meshs resuliert. (<code>player.gd</code>)</li></ol><h3 class="title is-4" id=die-praxis>Die Praxis</h3><p>Nun aber genug der Theorie, so gerne ich sie auch mag, aber manchmal ist Quellcode dann doch überzeugender. Bevor wir starten können, müssen ein paar Materialien angelegt werden. Ich habe für dieses Beispiel drei Standardmaterialien (<code>StandardMaterial3D</code>) angelegt, bei denen ich jeweils die Albedo-Farbe (<code>albedo_color</code>) auf rot, grün bzw. blau gestellt und abgespeichert habe. Mit dieser Vorbereitung können wir nun mit der Erweiterung des Players (<code>player.gd</code>) starten:</p><h4 class="title is-5" id=todo-1-und-2>ToDo 1 und 2</h4><p>Die Punkte 1 und 2 sind relativ schnell umgesetzt und sollten keiner weiteren Worte bedürfen:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#66d9ef>const</span> colorToMaterial: <span style=color:#a6e22e>Dictionary</span> <span style=color:#f92672>=</span> { SupportedColors<span style=color:#f92672>.</span>GREEN: preload(<span style=color:#e6db74>&#34;res://materials/green.tres&#34;</span>),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>										SupportedColors<span style=color:#f92672>.</span>BLUE: preload(<span style=color:#e6db74>&#34;res://materials/blue.tres&#34;</span>),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>										SupportedColors<span style=color:#f92672>.</span>RED: preload(<span style=color:#e6db74>&#34;res://materials/red.tres&#34;</span>),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>										}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#66d9ef>enum</span> SupportedColors { GREEN, BLUE, RED}</span></span></code></pre></div><h4 class="title is-5" id=todo-3>ToDo 3</h4><p>Anschließend kümmern wir uns um die Punkte 3.1 und 3.2, indem wir unser Property <code>currentColor</code> anlegen und den zugehörigen Setter schreiben:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#960050;background-color:#1e0010>@</span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>var</span> currentColor : SupportedColors <span style=color:#f92672>=</span> SupportedColors<span style=color:#f92672>.</span>GREEN:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>	set(color):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>		currentColor <span style=color:#f92672>=</span> color
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>		<span style=color:#66d9ef>if</span> is_ready:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>			mesh<span style=color:#f92672>.</span>surface_set_material(<span style=color:#ae81ff>0</span>, colorToMaterial[currentColor])
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span><span style=color:#960050;background-color:#1e0010>@</span><span style=color:#66d9ef>onready</span> <span style=color:#66d9ef>var</span> mesh: <span style=color:#a6e22e>Mesh</span> <span style=color:#f92672>=</span> <span style=color:#f92672>$</span>MeshInstance3D<span style=color:#f92672>.</span>mesh</span></span></code></pre></div><p>Das Property <code>is_ready</code> soll nur verhindern, dass wir das Material setzen, bevor wir Zugriff auf das Mesh haben. Damit dies funktioniert, benötigen wir noch zwei weitere Zeilen:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-gdscript data-lang=gdscript><span style=display:flex;background-color:#3c3d38><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span><span style=color:#66d9ef>var</span> is_ready :<span style=color:#f92672>=</span> false
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span><span style=color:#66d9ef>func</span> _ready() <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex;background-color:#3c3d38><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>	is_ready <span style=color:#f92672>=</span> true
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>	<span style=color:#66d9ef>if</span> player <span style=color:#f92672>==</span> multiplayer<span style=color:#f92672>.</span>get_unique_id():
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>		<span style=color:#f92672>$</span>Camera3D<span style=color:#f92672>.</span>current <span style=color:#f92672>=</span> true</span></span></code></pre></div><p>Nachdem wir das Property hinzugefügt haben, können wir auch die Replikationskonfiguration unseres <code>ServerSynchronizers</code> passend erweitern:</p><figure class="title is-6 is-centered"><img src=/images/blog/2023/material-synchronization/server_synchronizer_replication.webp alt="Replikation-Tab von ServerSynchronizer"><figcaption><h4>Replikation-Tab von ServerSynchronizer</h4></figcaption></figure><h4 class="title is-5" id=todo-4>ToDo 4</h4><p>Bei der Umsetzung des RPCs für Punkt 4, habe ich den gleichen Mechanismus genutzt wie im <a href=/de/tags/networking-tutorial/>früheren Artikel</a> für das Springen (<code>player_input.gd</code>). Zuerst fügen wir ein Property hinzu, welches den Materialänderungswunsch des Clients repräsentiert:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#960050;background-color:#1e0010>@</span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>var</span> switch_color :<span style=color:#f92672>=</span> false</span></span></code></pre></div><p>Anschließend erzeugen wir die Funktion, die wir per RPC aufrufen:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#960050;background-color:#1e0010>@</span>rpc(<span style=color:#e6db74>&#34;call_local&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#66d9ef>func</span> color_switch() <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>	switch_color <span style=color:#f92672>=</span> true</span></span></code></pre></div><p>Und zum Schluss erweitern wir unsere <code>_process()</code> Funktion, um die Tabulator-Taste mit dem RPC zu verbinden:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#66d9ef>func</span> _process(delta: <span style=color:#a6e22e>float</span>) <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>	direction <span style=color:#f92672>=</span> <span style=color:#a6e22e>Input</span><span style=color:#f92672>.</span>get_vector(<span style=color:#e6db74>&#34;ui_left&#34;</span>, <span style=color:#e6db74>&#34;ui_right&#34;</span>, <span style=color:#e6db74>&#34;ui_up&#34;</span>, <span style=color:#e6db74>&#34;ui_down&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>Input</span><span style=color:#f92672>.</span>is_action_just_pressed(<span style=color:#e6db74>&#34;ui_accept&#34;</span>):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>		jump<span style=color:#f92672>.</span>rpc_id(MultiplayerPeer<span style=color:#f92672>.</span>TARGET_PEER_SERVER)
</span></span><span style=display:flex;background-color:#3c3d38><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>Input</span><span style=color:#f92672>.</span>is_action_just_pressed(<span style=color:#e6db74>&#34;ui_focus_next&#34;</span>):
</span></span><span style=display:flex;background-color:#3c3d38><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>		color_switch<span style=color:#f92672>.</span>rpc_id(MultiplayerPeer<span style=color:#f92672>.</span>TARGET_PEER_SERVER)</span></span></code></pre></div><h4 class="title is-5" id=todo-5>ToDo 5</h4><p>Zuguterletzt fehlt noch die Reaktion auf den Materialänderungswunsch, der alle unsere Puzzleteile miteinander verbinden wird (<code>player.gd</code>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span><span style=color:#66d9ef>func</span> _process(_delta: <span style=color:#a6e22e>float</span>) <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>	<span style=color:#66d9ef>if</span> input<span style=color:#f92672>.</span>switch_color:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>		input<span style=color:#f92672>.</span>switch_color <span style=color:#f92672>=</span> false
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>		match currentColor:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span>			SupportedColors<span style=color:#f92672>.</span>GREEN:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span>				currentColor <span style=color:#f92672>=</span> SupportedColors<span style=color:#f92672>.</span>BLUE
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span>			SupportedColors<span style=color:#f92672>.</span>BLUE:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span>				currentColor <span style=color:#f92672>=</span> SupportedColors<span style=color:#f92672>.</span>RED
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span>			SupportedColors<span style=color:#f92672>.</span>RED:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span>				currentColor <span style=color:#f92672>=</span> SupportedColors<span style=color:#f92672>.</span>GREEN</span></span></code></pre></div><h4 class="title is-5" id=der-letzte-schritt>Der letzte Schritt</h4><figure class="title is-6 is-pulled-right"><img src=/images/blog/2023/material-synchronization/meshinstance3d_inspector.webp alt=MeshInstance3D><figcaption><h4>MeshInstance3D</h4></figcaption></figure><p>Wenn man an dieser Stelle unsere bisherige Erweiterung ausprobieren möchte, fällt auf, dass bereits vieles funktioniert. Durch Betätigung der Tabulator-Taste wird sich das Material und somit die Farbe der Spielfigur ändern, aber gleichzeitig ändert sich auch das Material jeder anderen Spielfigur.</p><p>Das liegt daran, dass sich alle Szenen standardmäßig die jeweiligen Ressourcen teilen. Wenn durch einen Client das Mesh-Material verändert wird, geschieht dies automatisch ebenfalls für alle anderen Spielfiguren, da alle dasselbe Mesh verwenden. Um dies zu ändern, müssen wir noch einen kleinen, aber entscheidenden, Haken in der Konfiguration der Mesh-Ressource setzen, nämlich den hinter &ldquo;Local to Scene&rdquo;, wie im nebenstehenden Bild ziemlich weit unten gezeigt. Dies bewirkt, dass alle Instanzen der Szene, also alle vorhandenen Spielfiguren, eigene Meshs benutzen.</p><p>Im Allgemeinen ist es eine gute Idee, dass die Engine versucht, möglichst viele Ressourcen einzusparen. Nur habe ich bei meinen Versuchen leider selbst nicht sofort daran gedacht und befürchtete schon, ich hätte Fehler bei der Programmierung gemacht. Durch ein wenig Debugging habe ich dann festgestellt, dass der Quellcode alles macht, wie es angedacht war und dann ist mir glücklicherweise auch wieder eingefallen, dass sich die Spielfiguren das Mesh teilen 😓.</p><h4 class="title is-4" id=fazit>Fazit</h4><p>Das hier gezeigte ist natürlich sehr rudimentär, sollte aber die generelle Methodik verdeutlichen. Natürlich kann man das beliebig weiter ausbauen oder auch auf andere Anwendungsfälle umbauen. Um dem Client bspw. einen ColorPicker anzubieten, könnte man einfach die RGBA-Werte übertragen und darauf basierend die Albedo-Farbe des aktuellen Mesh-Materials anpassen. Wie schon August Heinrich Hoffmann von Fallersleben sagte: &ldquo;<em>Die Gedanken sind frei, …</em>&rdquo;.</p><p>Natürlich findet ihr wie gewohnt den kompletten Quellcode in meinem <a href=https://github.com/somethinglikegames/godot4-network-tutorial/tree/material_replication target=_blank rel="noopener nofollow noreferrer">Tutorial Repository</a>.</p></div></article><footer class=columns><div class="column has-text-left"><a href=/de/blog/2023/interest-management-with-multiplayersynchronizer/ class="button right"><span class=icon-text><span class=icon><i class="fa fa-angle-left"></i></span><span>Interest Management mit dem MultiplayerSynchronizer</span></span></a></div><div class="column has-text-right"><a href=/de/blog/2023/latency-correlates-to-server-fps/ class="button left"><span class=icon-text><span>Netzwerklatenz korreliert mit Server-FPS</span><span class=icon><i class="fa fa-angle-right"></i></span></span></a></div></footer></div></div></div></section><footer class=footer><div class="container is-fluid has-text-centered"><ul class=socnet-icons><span class=icon><a href=//github.com/somethinglikegames target=_blank rel=noopener title=GitHub class="fab fa-github"></a></span>
<span class=icon><a href=//youtube.com/@somethinglikegames target=_blank rel=noopener title=YouTube class="fab fa-youtube"></a></span>
<span id=cloaked-1b9a3dd1f7></span>
<script id=cloaked-script-1b9a3dd1f7>var cloakElement=document.getElementById("cloaked-1b9a3dd1f7"),link=document.createElement("a"),address="ed.semagekilgnihtemos@ofni".split("").reverse().join("");link.href="mailto:"+address,link.classList="far fa-envelope",link.title="email",cloakElement.parentNode.replaceChild(link,cloakElement)</script></ul><p class=copyright><a href=https://www.somethinglikegames.de/de/legal_notice/>Impressum</a> &mdash;
<a href=https://www.somethinglikegames.de/de/privacy_policy/>Datenschutzerklärung</a> &mdash;
©2023-2024 Tobias Wink<br>Powered by <a href=https://gohugo.io/ title=0.109.0 target=_blank rel=noopener>Hugo</a></p></div></footer><script src=/js/navbar.min.js defer></script>
<script src=/js/copy-code-button.min.js defer></script></body></html>