<!doctype html><html lang=de><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/sass/main.min.143551db89e311bf410f22e9ac4f1dd2496146fdc9f5bf27ac1a1839c6ce424fc8526487f0733de4c3e7617b55e897f6b91b57dd3abbf3e9ab4e1a59c1448e44.css integrity="sha512-FDVR24njEb9BDyLprE8d0klhRv3J9b8nrBoYOcbOQk/IUmSH8HM95MPnYXtV6Jf2uRtX3Tq78+mrThpZwUSORA=="><link rel=stylesheet href=/css/all.min.a0921f068fa9017ba1288b77420fbde17d89619431fab12b4d996e3e124af17337ac1b80bc2bb62458509e6033ace757405b5881b0c1d0db837dd64c8783b607.css integrity="sha512-oJIfBo+pAXuhKIt3Qg+94X2JYZQx+rErTZluPhJK8XM3rBuAvCu2JFhQnmAzrOdXQFtYgbDB0NuDfdZMh4O2Bw=="><title>Something Like Games | Netzwerktutorial 4: Login 2 - Gateway- und Authentication-Server</title><link rel=apple-touch-icon sizes=57x57 href=/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/ms-icon-144x144.png"><meta name=theme-color content="#ffffff"><meta name=description content="In diesem Teil der Tutorialserie geht es um den zweiten Teil des Loginvorgangs. Der Loginaufruf wird vom Gateway- and den Authentication-Server weitergeleitet."><meta itemprop=description content="In diesem Teil der Tutorialserie geht es um den zweiten Teil des Loginvorgangs. Der Loginaufruf wird vom Gateway- and den Authentication-Server weitergeleitet."><meta name=twitter:description content="In diesem Teil der Tutorialserie geht es um den zweiten Teil des Loginvorgangs. Der Loginaufruf wird vom Gateway- and den Authentication-Server weitergeleitet."><meta property="og:description" content="In diesem Teil der Tutorialserie geht es um den zweiten Teil des Loginvorgangs. Der Loginaufruf wird vom Gateway- and den Authentication-Server weitergeleitet."></head><body><nav class="navbar is-light" role=navigation aria-label="main navigation"><div class=navbar-brand><a href=/de/ class=navbar-item><img src=/images/brand.webp alt="Something Like Games" width=128px height=28></a>
<a role=checkbox class=navbar-burger aria-label=menu aria-expanded=false data-target=navigation><span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span></a></div><div id=navigation class=navbar-menu><div class=navbar-end><div class=navbar-item><a href=/de/ class="nav link icon-text"><span class=icon><i class='fa fa-home'></i></span><span>Home</span></a></div><div class=navbar-item><a href=/de/contact/ class="nav link icon-text"><span class=icon><i class='fa fa-mail-bulk'></i></span><span>Kontakt</span></a></div><div class="navbar-item has-dropdown is-hoverable"><a class=navbar-link href=#>Deutsch (de)</a><div class="navbar-dropdown is-right"><a href=https://www.somethinglikegames.de/en/blog/2023/network-tutorial-4-login-2/ lang=en class=navbar-item>English (en)</a></div></div></div></div></nav><section class=section><div class=container><div class=columns><div class="column is-one-fifth"><section id=site-sidebar class=is-hidden-mobile><section id=site-intro class="block has-text-centered"><a href=/de/><img src=/images/logo.webp class=circle width=128px height=128px alt=somethinglikegames.de></a><header></header><main><p>Mein pers√∂nlicher Blog √ºber Spieleentwicklung als Einzelperson in Teilzeit</p></main><footer class="footer has-no-background"><span class=icon><a href=//github.com/somethinglikegames target=_blank rel=noopener title=GitHub class="fab fa-github"></a></span>
<span class=icon><a href=//youtube.com/@somethinglikegames target=_blank rel=noopener title=YouTube class="fab fa-youtube"></a></span>
<span id=cloaked-a10d1f2855></span>
<script id=cloaked-script-a10d1f2855>var cloakElement=document.getElementById("cloaked-a10d1f2855"),link=document.createElement("a"),address="ed.semagekilgnihtemos@ofni".split("").reverse().join("");link.href="mailto:"+address,link.classList="far fa-envelope",link.title="email",cloakElement.parentNode.replaceChild(link,cloakElement)</script></footer></section><div class=block><hr></div><section id=categories class="block categories"><header><h1><a href=/de/categories><span class=icon-text><span class=icon><i class="fa fa-folders"></i></span><span>Kategorien</span></span></a></h1></header><ul><li><a href=/de/categories/tutorial/><span class=icon-text><span class=icon><i class="fa fa-folder"></i></span><span>tutorial</span></span><span class=count>6</span></a><li><a href=/de/categories/misc/><span class=icon-text><span class=icon><i class="fa fa-folder"></i></span><span>misc</span></span><span class=count>3</span></a><li><a href=/de/categories/news/><span class=icon-text><span class=icon><i class="fa fa-folder"></i></span><span>news</span></span><span class=count>1</span></a></li></ul></section></section></div><div class=column><article class=card><div class=card-image><a href=/de/blog/2023/network-tutorial-4-login-2/ class=cover-image style="--bg-image:url('https://www.somethinglikegames.de/images/blog/2023/network-tutorial-4-login-2/communicating_servers.webp')"><img class=cover src=https://www.somethinglikegames.de/images/blog/2023/network-tutorial-4-login-2/communicating_servers.webp alt="Godot Engine 'Server', die miteinander kommunizieren"></a><div class=copyright><a href=https://github.com/YuriSizov/godot-emotes/blob/master/LICENSE class=has-text-grey target=_blank rel="noopener nofollow noreferrer">Godot emotes are licensed under CC-BY-4.0 by Yuri Sizov</a></div></div><header class=card-header><div class=card-header-title><h2 class=title><a href=/de/blog/2023/network-tutorial-4-login-2/>Netzwerktutorial 4: Login 2 - Gateway- und Authentication-Server</a></h2></div></header><div class="card-content is-size-5 content"><div class=columns><div class=column><time datetime="2023-03-12 11:30:00 +0100 +0100">12.03.2023</time></div></div><div class=columns><div class=column><div class=tags><span class="tag is-info is-light"><a href=/de/categories/tutorial/ class=has-text-info><span class=icon-text><span class=icon><i class="fa fa-folder"></i></span>
<span>Tutorial</span></span></a></span>
<span class="tag is-link is-light"><a href=/de/tags/networking-tutorial/ class=has-text-link><span class=icon-text><span class=icon><i class="fa fa-tag"></i></span>
<span>Networking-Tutorial</span></span></a></span>
<span class="tag is-link is-light"><a href=/de/tags/godot-engine/ class=has-text-link><span class=icon-text><span class=icon><i class="fa fa-tag"></i></span>
<span>Godot Engine</span></span></a></span>
<span class="tag is-link is-light"><a href=/de/tags/networking/ class=has-text-link><span class=icon-text><span class=icon><i class="fa fa-tag"></i></span>
<span>Networking</span></span></a></span></div></div></div><p>Der Quellcode zu den Artikeln ist in diesem <a href=https://github.com/somethinglikegames/godot4-network-tutorial target=_blank rel="noopener nofollow noreferrer">GitHub Repository</a> zu finden. Die folgende Liste zeigt alle bislang erschienenen Artikel dieser Serie:</p><ol><li><a href=/de/blog/2023/network-tutorial-1-overview/>Netzwerktutorial 1: Allgemeines und √úbersicht</a></li><li><a href=/de/blog/2023/network-tutorial-2-walking-skeleton/>Netzwerktutorial 2: Das "gehende Skelett"</a></li><li><a href=/de/blog/2023/network-tutorial-3-login-1/>Netzwerktutorial 3: Login 1 - Der Game-Client</a></li><li>Netzwerktutorial 4: Login 2 - Gateway- und Authentication-Server</li><li><a href=/de/blog/2023/network-tutorial-5-login-3/>Netzwerktutorial 5: Login 3 - World-Server</a></li><li><a href=/de/blog/2023/network-tutorial-6-dtls/>Netzwerktutorial 6: Verschl√ºsselte Verbindungen mit Hilfe von DTLS</a></li></ol><p>Im <a href=/de/blog/2023/network-tutorial-3-login-1/>letzten Artikel</a> haben wir den Game-Client soweit erstellt, dass er den Gateway-Server mit Logindaten kontaktieren m√∂chte. In diesem Artikel werden wir genau an dieser Stelle weiter machen und uns um den Gateway- und Authentication-Server k√ºmmern. Bevor wir uns aber um den eigentlichen Loginvorgang k√ºmmern k√∂nnen, m√ºssen wir zuerst Gateway- und Authentication-Server miteinander bekannt machen und daf√ºr sorgen, dass sie einander auch trauen. Wir benutzen daf√ºr einen Mechanismus, welcher eine gegenseitige Authentifizierung bereits w√§hrend des Verbindungsaufbaus erm√∂glicht und erst im November 2022 bei Godot 4 eingef√ºhrt wurde.</p><h3 class="title is-4" id=pre-authentifizierung>Pre-Authentifizierung</h3><p>Der Verfasser des <a href=https://github.com/godotengine/godot/pull/67917 target=_blank rel="noopener nofollow noreferrer">Pull-Requests</a> spricht dabei von Pre-Authentifizierung, weil die Authentifizierung bereits w√§hrend des Verbindungsaufbaus geschieht, w√§hrend wir im <a href=/de/blog/2023/network-tutorial-3-login-1/>Game-Client</a> die Login-Daten erst versendet haben, nachdem wir schon mit dem Gateway-Server verbunden sind, wir also das Signal <code>connected_to_server</code> bekommen haben. Trotz kurzer Beschreibung im <a href=https://github.com/godotengine/godot/pull/67917 target=_blank rel="noopener nofollow noreferrer">Pull-Request</a>, habe ich etwas experimentieren m√ºssen, um das gew√ºnschte Verhalten ans Laufen zu bekommen. Ich dachte zuerst, dass sich dabei nur der Client beim Server authentifiziert, aber es ist ein gegenseitiges Authentifizieren, und nur wenn beide Parteien der Verbindung zugestimmt haben, wird sie wirklich aufgebaut.</p><p>Um die Pre-Authentifizierung zu aktivieren, m√ºssen wir auf beiden Seiten im <code>SceneMultiplayer</code> Objekt den <code>auth_callback</code> mit einem <code>Callable</code> besetzen, welches die Authentifizierungslogik enth√§lt. Dazu kommt, dass uns w√§hrend des Verbindungsaufbaus bislang nur die Signale <code>connected_to_server</code> und <code>connection_failed</code> als Client bzw. <code>peer_connected</code> und <code>peer_disconnected</code> als Server interessiert haben. Im Rahmen der Pre-Authenfizierung beachten wir nun zus√§tzlich auf beiden Seiten die beiden weiteren Signale <code>peer_authenticating</code> und <code>peer_authentication_failed</code>.</p><p>Das Signal <code>peer_authenticating</code> wird emittiert, wenn eine neue Verbindung aufgebaut wird, und sollte genutzt werden, um mit Hilfe von <code>send_auth(id: int, data: PackedByteArray)</code> die authentifizierungsrelevanten Daten an die Gegenstelle zu senden. Durch <code>send_auth()</code> wird dann der hinterlegte <code>auth_callback</code> bei der Gegenstelle ausgel√∂st, um die gesendeten Daten zu validieren. Der Erfolgsfall wird dann <code>complete_auth(id: int)</code> signalisiert. Wenn dies beide Parteien innerhalb von 30 Sekunden getan haben, wird die Netzwerkverbindung final aufgebaut und mit Hilfe von <code>connected_to_server</code> dem Client bzw. <code>peer_connected</code> dem Server mitgeteilt.</p><p>So, genug der Theorie, hier nun der Beispielcode des Gateway-Servers (Client):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Node</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#960050;background-color:#1e0010>@</span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>var</span> authentication_server :<span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;127.0.0.1&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#960050;background-color:#1e0010>@</span>export_range(<span style=color:#ae81ff>1025</span>, <span style=color:#ae81ff>65536</span>) <span style=color:#66d9ef>var</span> authentication_server_port :<span style=color:#f92672>=</span> <span style=color:#ae81ff>1911</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#960050;background-color:#1e0010>@</span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>var</span> shared_secret :<span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;JustARandomValueYouCantGuess&#34;</span><span style=color:#f92672>.</span>to_utf8_buffer()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#66d9ef>var</span> _crypto :<span style=color:#f92672>=</span> Crypto<span style=color:#f92672>.</span>new()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#66d9ef>var</span> network :<span style=color:#f92672>=</span> ENetMultiplayerPeer<span style=color:#f92672>.</span>new()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#66d9ef>var</span> shutdown_hook : Callable
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#66d9ef>var</span> gateway_server : <span style=color:#a6e22e>Node</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#66d9ef>func</span> startup() <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>	print(<span style=color:#e6db74>&#34;Connecting to </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>:</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> [authentication_server, authentication_server_port])
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>	<span style=color:#66d9ef>var</span> ret <span style=color:#f92672>=</span> network<span style=color:#f92672>.</span>create_client(authentication_server, authentication_server_port)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>	<span style=color:#66d9ef>var</span> _hash :<span style=color:#f92672>=</span> _crypto<span style=color:#f92672>.</span>hmac_digest(HashingContext<span style=color:#f92672>.</span>HASH_SHA256, shared_secret,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>			Time<span style=color:#f92672>.</span>get_date_string_from_system(true)<span style=color:#f92672>.</span>to_utf8_buffer())
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>	<span style=color:#66d9ef>if</span> ret <span style=color:#f92672>==</span> OK:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>		multiplayer<span style=color:#f92672>.</span>multiplayer_peer <span style=color:#f92672>=</span> network
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>		multiplayer<span style=color:#f92672>.</span>connection_failed<span style=color:#f92672>.</span>connect(_on_connection_failed<span style=color:#f92672>.</span>bind(FAILED))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>		multiplayer<span style=color:#f92672>.</span>connected_to_server<span style=color:#f92672>.</span>connect(<span style=color:#66d9ef>func</span>() <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>				print(<span style=color:#e6db74>&#34;Succesfully connected to authentication server </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>:</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>						<span style=color:#f92672>%</span> [authentication_server, authentication_server_port]))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>        multiplayer<span style=color:#f92672>.</span>peer_authenticating<span style=color:#f92672>.</span>connect(<span style=color:#66d9ef>func</span>(server_id: <span style=color:#a6e22e>int</span>) <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>				print(<span style=color:#e6db74>&#34;server_id </span><span style=color:#e6db74>%d</span><span style=color:#e6db74> peer_authenticating&#34;</span> <span style=color:#f92672>%</span> server_id)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>				<span style=color:#66d9ef>if</span> server_id <span style=color:#f92672>==</span> MultiplayerPeer<span style=color:#f92672>.</span>TARGET_PEER_SERVER:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>					multiplayer<span style=color:#f92672>.</span>send_auth(server_id, _hash))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>		multiplayer<span style=color:#f92672>.</span>peer_authentication_failed<span style=color:#f92672>.</span>connect(<span style=color:#66d9ef>func</span>(server_id: <span style=color:#a6e22e>int</span>) <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>				print(<span style=color:#e6db74>&#34;server_id </span><span style=color:#e6db74>%d</span><span style=color:#e6db74> peer_authentication_failed&#34;</span> <span style=color:#f92672>%</span> server_id))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>		multiplayer<span style=color:#f92672>.</span>auth_callback <span style=color:#f92672>=</span> \
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>				<span style=color:#66d9ef>func</span>(server_id: <span style=color:#a6e22e>int</span>, data: PackedByteArray) <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>					print(<span style=color:#e6db74>&#34;server </span><span style=color:#e6db74>%d</span><span style=color:#e6db74> sent </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> [server_id, data<span style=color:#f92672>.</span>hex_encode()])
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>					<span style=color:#66d9ef>if</span> _crypto<span style=color:#f92672>.</span>constant_time_compare(_hash, data):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>						multiplayer<span style=color:#f92672>.</span>complete_auth(server_id)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>					<span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>						print(<span style=color:#e6db74>&#34;Validation was not successful&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>	<span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>		_on_connection_failed(ret)</span></span></code></pre></div><div class="message is-warning"><div class=message-body>Aus Sicherheitsgr√ºnden sollte in einem Produktivszenario nat√ºrlich kein Passwort/Shared-Secret o.√§. direkt im Quellcode hinterlegt sein, sondern als Ressource oder per Konfigurationsdatei geladen werden. Aber f√ºr das Tutorial war es bequemer, es direkt im Quellcode zu hinterlegen.</div></div><p>Im Quellcode sollten alle vorher erw√§hnten Stellen zu finden sein. Die Validierung der Authentifizierung findet anhand des aktuellen Systemdatums (UTC) statt. Damit (Zeile 17) erstellt der Gateway-Server ein <a href=https://de.wikipedia.org/wiki/HMAC target=_blank rel="noopener nofollow noreferrer">HMAC</a> (Zeile 16). Der Schl√ºssel muss daf√ºr auf beiden Servern identisch sein. Das aktuelle Systemdatum (UTC) habe ich verwendet, weil beide Server nur ungef√§hr die gleiche Systemzeit ben√∂tigen und es nur w√§hrend der Minuten um Mitternacht herum zu Problem f√ºhren k√∂nnte. In der Praxis sollte nat√ºrlich sichergestellt sein, dass alle Server eine m√∂glichst genaue Systemzeit haben, sodass man dort die √úberpr√ºfung nicht auf Tagesbasis macht, sondern auf Minutenbasis. Dadurch sind Replay-Attacken deutlich schwerer durchzuf√ºhren, da sich der erzeugte HMAC jede Minute √§ndert, und nicht, wie im Beispiel gezeigt, nur jeden Tag.</p><p>Der zugeh√∂rige Quellcode im Authentication-Server sieht vergleichbar aus. Der gr√∂√üte Unterschied ist wohl, dass hier bei jeder Anfrage bzw. jeder Validierung neue HMACs erzeugt werden, da ja unbekannt ist, ob ein √§lterer HMAC noch g√ºltig sein kann:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Node</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#960050;background-color:#1e0010>@</span>export_range(<span style=color:#ae81ff>1025</span>, <span style=color:#ae81ff>65536</span>) <span style=color:#66d9ef>var</span> network_port :<span style=color:#f92672>=</span> <span style=color:#ae81ff>1911</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#960050;background-color:#1e0010>@</span>export_range(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>4095</span>) <span style=color:#66d9ef>var</span> max_clients :<span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#960050;background-color:#1e0010>@</span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>var</span> shared_secret :<span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;JustARandomValueYouCantGuess&#34;</span><span style=color:#f92672>.</span>to_utf8_buffer()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#66d9ef>var</span> _crypto <span style=color:#f92672>=</span> Crypto<span style=color:#f92672>.</span>new()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#66d9ef>var</span> peers <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#66d9ef>func</span> startup() <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>	<span style=color:#66d9ef>var</span> network :<span style=color:#f92672>=</span> ENetMultiplayerPeer<span style=color:#f92672>.</span>new()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>	<span style=color:#66d9ef>var</span> ret :<span style=color:#f92672>=</span> network<span style=color:#f92672>.</span>create_server(network_port, max_clients)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>	<span style=color:#66d9ef>if</span> ret <span style=color:#f92672>==</span> OK:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>		multiplayer<span style=color:#f92672>.</span>server_relay <span style=color:#f92672>=</span> false
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>		multiplayer<span style=color:#f92672>.</span>set_multiplayer_peer(network)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>		print(<span style=color:#e6db74>&#34;Server started on port </span><span style=color:#e6db74>%d</span><span style=color:#e6db74>, allowing max </span><span style=color:#e6db74>%d</span><span style=color:#e6db74> connections&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>				<span style=color:#f92672>%</span> [network_port, max_clients])
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>		multiplayer<span style=color:#f92672>.</span>peer_connected<span style=color:#f92672>.</span>connect(
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>				<span style=color:#66d9ef>func</span>(client_id: <span style=color:#a6e22e>int</span>) <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>						print(<span style=color:#e6db74>&#34;Client </span><span style=color:#e6db74>%d</span><span style=color:#e6db74> connected&#34;</span> <span style=color:#f92672>%</span> client_id))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>		multiplayer<span style=color:#f92672>.</span>peer_disconnected<span style=color:#f92672>.</span>connect(
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>				<span style=color:#66d9ef>func</span>(client_id: <span style=color:#a6e22e>int</span>) <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>						print(<span style=color:#e6db74>&#34;Client </span><span style=color:#e6db74>%d</span><span style=color:#e6db74> disconnected&#34;</span> <span style=color:#f92672>%</span> client_id)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>						peers<span style=color:#f92672>.</span>erase(client_id))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>		multiplayer<span style=color:#f92672>.</span>peer_authenticating<span style=color:#f92672>.</span>connect(
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>				<span style=color:#66d9ef>func</span>(client_id: <span style=color:#a6e22e>int</span>) <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>						print(<span style=color:#e6db74>&#34;Client </span><span style=color:#e6db74>%d</span><span style=color:#e6db74> peer_authenticating&#34;</span> <span style=color:#f92672>%</span> client_id)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>						<span style=color:#66d9ef>var</span> _hash :<span style=color:#f92672>=</span> _crypto<span style=color:#f92672>.</span>hmac_digest(HashingContext<span style=color:#f92672>.</span>HASH_SHA256,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>                        		shared_secret,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>                                Time<span style=color:#f92672>.</span>get_date_string_from_system(true)<span style=color:#f92672>.</span>to_utf8_buffer())
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>						multiplayer<span style=color:#f92672>.</span>send_auth(client_id, _hash))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>		multiplayer<span style=color:#f92672>.</span>peer_authentication_failed<span style=color:#f92672>.</span>connect(
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>				<span style=color:#66d9ef>func</span>(client_id: <span style=color:#a6e22e>int</span>) <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>						print(<span style=color:#e6db74>&#34;Client </span><span style=color:#e6db74>%d</span><span style=color:#e6db74> peer_authentication_failed&#34;</span> <span style=color:#f92672>%</span> client_id))
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>		multiplayer<span style=color:#f92672>.</span>auth_callback <span style=color:#f92672>=</span> \
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>				<span style=color:#66d9ef>func</span>(client_id: <span style=color:#a6e22e>int</span>, data: PackedByteArray) <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>						print(<span style=color:#e6db74>&#34;Client </span><span style=color:#e6db74>%d</span><span style=color:#e6db74> sent: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> [client_id, data<span style=color:#f92672>.</span>hex_encode()])
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span>						<span style=color:#66d9ef>var</span> _hash :<span style=color:#f92672>=</span> _crypto<span style=color:#f92672>.</span>hmac_digest(HashingContext<span style=color:#f92672>.</span>HASH_SHA256,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span>								shared_secret,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span>								Time<span style=color:#f92672>.</span>get_date_string_from_system(true)<span style=color:#f92672>.</span>to_utf8_buffer())
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span>						<span style=color:#66d9ef>if</span> _crypto<span style=color:#f92672>.</span>constant_time_compare(_hash, data):
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span>							multiplayer<span style=color:#f92672>.</span>complete_auth(client_id)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span>							peers<span style=color:#f92672>.</span>append(client_id)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span><span>						<span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span><span>							print(<span style=color:#e6db74>&#34;Validation was not successful&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53</span><span>		print(<span style=color:#e6db74>&#34;Error while starting server: </span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> ret)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54</span><span>		get_tree()<span style=color:#f92672>.</span>quit(ret)</span></span></code></pre></div><h3 class="title is-4" id=gateway-server>Gateway-Server</h3><p>Nachdem nun Gateway- und Authentication-Server schon einmal grundlegend miteinander kommunizieren k√∂nnen, und insgesamt viel wichtiger, einander soweit vertrauen k√∂nnen, fangen wir in diesem Abschnitt an, die eigentliche Aufgabe des Gateway-Servers zu implementieren, n√§mlich machine-in-the-middle üòâ zwischen Client und Authentication-Server zu sein.</p><figure class="title is-6 center"><img src=/images/blog/2023/network-tutorial-3-login-1/login_sequence_synchrone.webp alt="Synchrone Loginsequenz"><figcaption><h4>Synchrone Loginsequenz</h4></figcaption></figure><p>Im <a href=/de/blog/2023/network-tutorial-3-login-1/>letzten Artikel</a> haben wir als Game-Client die Funktion <code>s_login_request()</code> auf dem Gateway-Server mit den eingegebenen Logindaten aufgerufen. Damit ist dies nun unser Einstiegspunkt. Das Sequenzdiagramm zur synchronen Loginsequenz ist abermals unser Vorbild und wir k√∂nnen dem Diagramm entnehmen, dass wir als n√§chsten Schritt den Login-Request des Game-Clients an den Authentication-Server weiterleiten. Daf√ºr implementieren wir zun√§chst die aufgerufene Funktion innerhalb von <code>gateway_server.gd</code> des Gateway-Servers:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span><span style=color:#960050;background-color:#1e0010>@</span>rpc(<span style=color:#e6db74>&#34;call_remote&#34;</span>, <span style=color:#e6db74>&#34;any_peer&#34;</span>, <span style=color:#e6db74>&#34;reliable&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span><span style=color:#66d9ef>func</span> s_login_request(username: <span style=color:#a6e22e>String</span>, password: <span style=color:#a6e22e>String</span>) <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span><span>	<span style=color:#66d9ef>var</span> player_id :<span style=color:#f92672>=</span> multiplayer<span style=color:#f92672>.</span>get_remote_sender_id()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span><span>	print(<span style=color:#e6db74>&#34;login request received by </span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> player_id)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span><span>	authentication_server<span style=color:#f92672>.</span>authenticate_player(username, password, player_id)</span></span></code></pre></div><p>Wie wir sehen, wird dort neben einer Debug-Konsolenausgabe die Funktion <code>authenticate_player()</code> innerhalb von <code>authentication_server.gd</code> aufgerufen. Als Parameter werden die √ºbermittelten Logindaten sowie die Network-ID des Game-Clients √ºbergeben. Diese Network-ID wird zuvor in Zeile 50 durch den Aufruf von <code>multiplayer.get_remote_sender_id()</code> ermittelt. Wie man in dem nachfolgenden Code sieht, werden durch den Aufruf von <code>authenticate_player()</code> in <code>authentication_server.gd</code> eigentlich nur die √ºbergebenen Parameter an den Authentication-Server √ºbermittelt. Der Authentication-Server ben√∂tigt zwar nur die Logindaten und nicht die Network-ID des Game-Clients, aber wir schleusen sie dennoch √ºber den Authentication-Server, damit wir bei der sp√§teren Weiterleitung der Antwort an den Game-Client noch wissen, wie wir ihn erreichen k√∂nnen.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55</span><span><span style=color:#66d9ef>func</span> authenticate_player(username: <span style=color:#a6e22e>String</span>, password: <span style=color:#a6e22e>String</span>, player_id: <span style=color:#a6e22e>int</span>) <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56</span><span>	print(<span style=color:#e6db74>&#34;sending authentication request for player_id: </span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> player_id)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57</span><span>	s_authenticate_player<span style=color:#f92672>.</span>rpc_id(MultiplayerPeer<span style=color:#f92672>.</span>TARGET_PEER_SERVER,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58</span><span>			username, password, player_id)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61</span><span><span style=color:#960050;background-color:#1e0010>@</span>rpc(<span style=color:#e6db74>&#34;call_remote&#34;</span>, <span style=color:#e6db74>&#34;any_peer&#34;</span>, <span style=color:#e6db74>&#34;reliable&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62</span><span><span style=color:#66d9ef>func</span> s_authenticate_player(_username: <span style=color:#a6e22e>String</span>, _password: <span style=color:#a6e22e>String</span>, _player_id: <span style=color:#a6e22e>int</span>) \
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63</span><span> <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64</span><span>	<span style=color:#66d9ef>pass</span> <span style=color:#75715e># on authentication server</span></span></span></code></pre></div><p>Wie im Sequenzdiagramm gezeigt und im Absatz zuvor angesprochen, hat der Gateway-Server ebenfalls die Aufgabe, die Antwort des Authentication-Servers an den Game-Client weiterzuleiten. Daf√ºr stellt der Gateway-Server die Funktion <code>c_authentication_result()</code> in <code>authentication_server.gd</code> bereit. Diese wird dann vom Authentication-Server via RPC aufgerufen. Als Parameter werden das Resultat, die Network-ID des Game-Clients und im Erfolgsfall ein Token √ºbermittelt. Wie zuvor gilt weiterhin, dass der Gateway-Server keine eigene Logik hat, sondern nur als Vermittler zwischen Game-Client und Authentication-Server fungiert, daher wird auch hier neben Debug-Konsolenmeldungen nur die Funktion <code>return_login_request()</code> von <code>gateway_server.gd</code> mit den erhaltenen Parametern aufgerufen (Zeile 68).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65</span><span><span style=color:#960050;background-color:#1e0010>@</span>rpc(<span style=color:#e6db74>&#34;call_remote&#34;</span>, <span style=color:#e6db74>&#34;authority&#34;</span>, <span style=color:#e6db74>&#34;reliable&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66</span><span><span style=color:#66d9ef>func</span> c_authentication_result(result: <span style=color:#a6e22e>bool</span>, player_id: <span style=color:#a6e22e>int</span>, token: <span style=color:#a6e22e>String</span>) <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67</span><span>	print(<span style=color:#e6db74>&#34;authentication result for player_id: </span><span style=color:#e6db74>%d</span><span style=color:#e6db74> is </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> [player_id, str(result)])
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">68</span><span>	gateway_server<span style=color:#f92672>.</span>return_login_request(result, token, player_id)</span></span></code></pre></div><p>Wie zu erwarten, leitet die Funktion <code>return_login_request()</code> in <code>gateway_server.gd</code> alle Parameter via RPC an den urspr√ºnglichen Game-Client weiter (Zeile 42). Sollte nach diesem RPC-Aufruf noch eine Verbindung mit dem Game-Client bestehen, so wird sie getrennt, sobald alle vorgesehenen Nachrichten wirklich versendet wurden (Zeile 43-45). Es kann in der Praxis auch vorkommen, dass der Game-Client die Verbindung trennt, w√§hrend der Gateway-Server gerade dabei ist, Zeile 199 auszuf√ºhren. In diesem Fall f√ºhrt Zeile 200 zu einer Fehlermeldung, die wir dann ignorieren k√∂nnen.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span><span style=color:#66d9ef>func</span> return_login_request(result: <span style=color:#a6e22e>bool</span>, token: <span style=color:#a6e22e>String</span>, player_id: <span style=color:#a6e22e>int</span>) <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>	c_login_response<span style=color:#f92672>.</span>rpc_id(player_id, result, token)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>	<span style=color:#66d9ef>var</span> peer: ENetPacketPeer <span style=color:#f92672>=</span> multiplayer<span style=color:#f92672>.</span>multiplayer_peer<span style=color:#f92672>.</span>get_peer(player_id)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span>	<span style=color:#66d9ef>if</span> peer <span style=color:#f92672>!=</span> null:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span>		peer<span style=color:#f92672>.</span>peer_disconnect_later()</span></span></code></pre></div><p>Damit haben wir die komplette Funktionalit√§t des Gateway-Servers fertig implementiert.</p><h3 class="title is-4" id=authentication-server>Authentication-Server</h3><p>Die zentrale Aufgabe unseres Authentication-Servers ist die Verifikation von √ºbermittelten Logindaten. Sollten die Logindaten g√ºltig sein, kommt die Erzeugung eines Tokens, der vom World-Server akzeptiert wird, dazu. Wie man im nachfolgenden Code-Snippet erkennen kann, mache ich mir das Leben mal wieder etwas einfacher, indem aktuell alle Logindaten g√ºltig sind, deren Benutzername und Passwort √ºbereinstimmen (Zeile 73).</p><div class="message is-warning"><div class=message-body><p>In der Realit√§t w√ºrde man dies anders machen und stattdessen den Passworthash, welcher mit einem <a href=https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html target=_blank rel="noopener nofollow noreferrer">sicheren Verfahren</a> erzeugt wurde, zum √ºbermittelten Benutzernamen aus der Datenbank auslesen und anschlie√üend das √ºbermittelte Passwort mit dem Passworthash der Datenbankabfrage pr√ºfen. Ich habe vor, auf dieses Thema in einem sp√§teren Artikel genauer einzugehen, aber noch ist nicht die passende Zeit daf√ºr.</p><p>Zumal Godot 4 zum Zeitpunkt der Artikelver√∂ffentlichung nicht einmal 2 Wochen alt ist und es daher aktuell noch keine stabilen AddOns f√ºr Datenbankclients gibt, auch wenn <a href=https://github.com/2shady4u/godot-sqlite/tree/gd-extension target=_blank rel="noopener nofollow noreferrer">godot-sqlite</a> und <a href=https://github.com/Marzin-bot/PostgreSQLClient/tree/alpha target=_blank rel="noopener nofollow noreferrer">PostgreSQLClient</a> bereits erste Testversionen f√ºr Godot 4 bereitstellen.</p></div></div><p>Wie wir in Zeile 78 sehen k√∂nnen, wird hier noch kein Token erzeugt, damit besch√§ftigen wir uns gezielt im n√§chsten Abschnitt. In Zeile 79 werden dann Resultat, <code>player_id</code> (Network-ID des Game-Clients) und ein Token per RPC an den Gateway-Server geschickt, von dem der Request kam.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">69</span><span><span style=color:#960050;background-color:#1e0010>@</span>rpc(<span style=color:#e6db74>&#34;call_remote&#34;</span>, <span style=color:#e6db74>&#34;any_peer&#34;</span>, <span style=color:#e6db74>&#34;reliable&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">70</span><span><span style=color:#66d9ef>func</span> s_authenticate_player(username: <span style=color:#a6e22e>String</span>, password: <span style=color:#a6e22e>String</span>, player_id: <span style=color:#a6e22e>int</span>) <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">71</span><span>	print(<span style=color:#e6db74>&#34;authentication requested for player_id: </span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> player_id)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">72</span><span>	<span style=color:#66d9ef>var</span> gateway_id :<span style=color:#f92672>=</span> multiplayer<span style=color:#f92672>.</span>get_remote_sender_id()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">73</span><span>	<span style=color:#66d9ef>var</span> result <span style=color:#f92672>=</span> username <span style=color:#f92672>==</span> password <span style=color:#75715e># add real user accounts and real check</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">74</span><span>	print(<span style=color:#e6db74>&#34;return authentication result (</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>) for player_id: </span><span style=color:#e6db74>%d</span><span style=color:#e6db74> to gateway_id: </span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">75</span><span>			<span style=color:#f92672>%</span> [str(result), player_id, gateway_id])
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">76</span><span>	<span style=color:#66d9ef>var</span> token :<span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">77</span><span>	<span style=color:#66d9ef>if</span> result:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">78</span><span>		<span style=color:#66d9ef>pass</span> <span style=color:#75715e># Create Token</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">79</span><span>	c_authentication_result<span style=color:#f92672>.</span>rpc_id(gateway_id, result, player_id, token)</span></span></code></pre></div><h4 class="title is-5" id=tokenerzeugung>Tokenerzeugung</h4><p>Ich habe die Tokenerzeugung in einen Extraabschnitt verlagert, da ich mir vorstellen kann, dass nicht jeder bereits mit <a href=https://jwt.io/ target=_blank rel="noopener nofollow noreferrer">JWTs</a> vertraut ist und ich daher etwas allgemeiner mit dem Thema anfangen m√∂chte. <a href=https://jwt.io/ target=_blank rel="noopener nofollow noreferrer">JWT</a> (ausgesprochen &ldquo;jot&rdquo;) ist die Abk√ºrzung f√ºr JSON Web Token und wird in <a href=https://www.rfc-editor.org/rfc/rfc7519 target=_blank rel="noopener nofollow noreferrer">RFC 7519</a> definiert bzw. standardisiert. In <a href=https://www.rfc-editor.org/rfc/rfc7519 target=_blank rel="noopener nofollow noreferrer">RFC 7519</a> steht folgende Kurzbeschreibung f√ºr JWTs:</p><blockquote><p>JSON Web Token (JWT) is a compact, URL-safe means of representing claims to be transferred between two parties. The claims in a JWT are encoded as a JSON object that is used as the payload of a JSON Web Signature (JWS) structure or as the plaintext of a JSON Web Encryption (JWE) structure, enabling the claims to be digitally signed or integrity protected with a Message Authentication Code (MAC) and/or encrypted.</p></blockquote><p>Wir haben es also mit einem kompakten URL-sicheren Mittel zur √úbertragung von Claims zwischen zwei Parteien zu tun. Die Claims werden als JSON-Objekte enkodiert und k√∂nnen innerhalb von JSON Web Signaturen (JWS) oder JSON Web Verschl√ºsselungen (JWE) benutzt werden. Wir werden sie als Teil von JSON Web Signaturen einsetzen und sch√ºtzen sie vor Ver√§nderung (dazu dann sp√§ter mehr). Bei Claims handelt es sich ganz abstrakt um Aussagen oder Zuweisungen √ºber eine bestimmte Partei oder ein Objekt und sie k√∂nnen lapidar als Informationen beschrieben werden. Wir haben somit ein standardisiertes Format, um Informationen zwischen zwei Parteien zu √ºbertragen und k√∂nnen diese Informationen vor Ver√§nderung sch√ºtzen. Genau das, was wir ben√∂tigen, um dem Game-Client den Zugriff auf den World-Server zu erlauben, ohne dass der World-Server die Identit√§t des Game-Clients √ºberpr√ºfen kann.</p><p>F√ºr den Schutz vor Ver√§nderung setzen wir auf den Algorithmus <code>RSA SHA256</code>, wir erzeugen also mit Hilfe von <a href=https://de.wikipedia.org/wiki/SHA-2 target=_blank rel="noopener nofollow noreferrer"><code>SHA256</code></a> einen Hashwert unserer Claims und signieren diesen mit Hilfe von <a href=https://de.wikipedia.org/wiki/RSA-Kryptosystem target=_blank rel="noopener nofollow noreferrer">RSA</a>. Das hat den Vorteil, dass wir durch den Einsatz des asymmetrischen RSA-Verfahrens zwei verschiedene Schl√ºssel f√ºr die Signierung und Signaturpr√ºfung verwenden. Dadurch bleibt auch bei Kompromittierung des World-Servers, also Diebstahl, Hack o.√§., weiterhin der Authentication-Server die einzige Partei, die unsere Tokens ausstellen kann.</p><p>Grundlegend l√§sst sich ein JWT in drei Teile Aufteilen: Header, Payload und Signature, die jeweils mit einem <code>.</code> getrennt werden. Header und Payload werden Base64-URL enkodiert, damit es beim Transfer via HTTP keine Probleme gibt. Was in einem JWT an Informationen steckt, l√§sst sich bspw. im <a href=https://jwt.io/#debugger-io target=_blank rel="noopener nofollow noreferrer">Debugger von jwt.io</a> √ºberpr√ºfen. Wer noch weitere Informationen zum Thema JWT haben m√∂chte, kann sich nat√ºrlich im <a href=https://www.rfc-editor.org/rfc/rfc7519 target=_blank rel="noopener nofollow noreferrer">RFC 7519</a> oder auf <a href=https://jwt.io/ target=_blank rel="noopener nofollow noreferrer">jwt.io</a> informieren oder aber einen <a href=https://www.sainth.de/de/blog/jwts-and-basic-auth/ target=_blank rel="noopener nofollow noreferrer">Artikel</a> lesen, den ich vor Jahren mal dazu geschrieben habe.</p><div class="message is-danger"><div class=message-body>So wie wir hier JWTs einsetzen, also als Teil von JWS, sind die enthaltenen Informationen f√ºr jeden lesbar und sollten somit KEINE sensiblen Informationen beinhalten!</div></div><p>So, genug der Theorie, wenden wir es nun in der Praxis an. Bevor wir damit aber starten k√∂nnen, m√ºssen wir beim Authentication-Server noch Support f√ºr JWTs in Form eines <a href=https://github.com/fenix-hub/godot-engine.jwt/tree/main-godot4 target=_blank rel="noopener nofollow noreferrer">AddOns</a> nachr√ºsten. Daf√ºr laden wir zun√§chst das <a href=https://github.com/fenix-hub/godot-engine.jwt/releases target=_blank rel="noopener nofollow noreferrer">aktuellste Release</a> f√ºr Godot 4 herunter und entpacken den Ordner <code>addons</code> in unser Godot-Projekt des Authentication-Servers. Anschlie√üend muss das AddOn evtl. noch in den <code>Projekteinstellungen -> Plugins</code> aktiviert werden. Um alles in Betrieb nehmen zu k√∂nnen, ben√∂tigen wir noch ein Schl√ºsselpaar im <a href=https://de.wikipedia.org/wiki/Privacy_Enhanced_Mail target=_blank rel="noopener nofollow noreferrer">PEM-Format</a>. Da ich √ºberwiegend unter Linux arbeite, nutze ich hier die entsprechenden Linux-Befehle, aber mit einer kurzen Recherche sollte man auch auf die passenden Befehle f√ºr Windows sto√üen k√∂nnen:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>authentication_server&gt; mkdir crypto
</span></span><span style=display:flex><span>authentication_server&gt; cd crypto
</span></span><span style=display:flex><span>authentication_server/crypto&gt; ssh-keygen -t rsa -b <span style=color:#ae81ff>4096</span> -m pem -f jwt_rsa.key
</span></span><span style=display:flex><span>authentication_server/crypto&gt; ssh-keygen -f jwt_rsa.key.pub -e -m pem &gt; jwt_rsa.pem
</span></span><span style=display:flex><span>authentication_server/crypto&gt; rm jwt_rsa.key.pub</span></span></code></pre></div><div class="message is-warning"><div class=message-body>Da ich mir nur wenige F√§lle vorstellen kann, wo es nicht fahrl√§ssig w√§re, (private) Schl√ºssel in ein Repository zu speisen, habe ich den Ordner <code>crypto/</code> in der zugeh√∂rigen <code>.gitignore</code> des Authentication-Servers hinzugef√ºgt.</div></div><p>Nun sind wir endlich wirklich soweit, den Authentication-Server um die Tokenerzeugung zu erweitern. Der erste Schritt hierf√ºr ist es, eine zentrale Variable vom Typ <code>JWTAlgorithm</code> anzulegen (Zeile 10), welche wir anschlie√üend in <code>_ready()</code> initialisieren:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#66d9ef>var</span> jwt_algorithm: JWTAlgorithm
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#66d9ef>func</span> _ready() <span style=color:#f92672>-&gt;</span> void:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>	<span style=color:#66d9ef>var</span> private_key :<span style=color:#f92672>=</span> CryptoKey<span style=color:#f92672>.</span>new()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>	<span style=color:#66d9ef>var</span> load_ret :<span style=color:#f92672>=</span> private_key<span style=color:#f92672>.</span>load(<span style=color:#e6db74>&#34;res://crypto/jwt_rsa.key&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>	<span style=color:#66d9ef>if</span> load_ret <span style=color:#f92672>==</span> OK:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>		jwt_algorithm <span style=color:#f92672>=</span> JWTAlgorithm<span style=color:#f92672>.</span>new()
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>		jwt_algorithm<span style=color:#f92672>.</span>_private_crypto <span style=color:#f92672>=</span> private_key
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>		jwt_algorithm<span style=color:#f92672>.</span>_alg <span style=color:#f92672>=</span> JWTAlgorithm<span style=color:#f92672>.</span>Type<span style=color:#f92672>.</span>RSA256
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>	<span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>		print(<span style=color:#e6db74>&#34;Error while reading RSA private key: </span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> load_ret)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>		get_tree()<span style=color:#f92672>.</span>quit(load_ret)</span></span></code></pre></div><p>Bevor wir die Initialisierung von <code>jwt_algorithm</code> vornehmen k√∂nnen, m√ºssen wir zuerst unseren privaten Schl√ºssel laden (Zeilen 14-15). Sollte dies geklappt haben, erzeugen wir ein neues Objekt vom Typ <code>JWTAlgorithm</code> (Zeile 17) und initialisieren es mit dem privaten Schl√ºssel und unserem gew√§hlten Hash-/Signierungsverfahren (Zeilen 18-19). Sollte beim Laden des privaten Schl√ºssels etwas schiefgelaufen sein, beenden wir den Authentication-Server, da er ohne privaten Schl√ºssel nicht in der Lage sein wird, Tokens zu erzeugen.</p><p>Um nun einen wirklichen Token zu erzeugen, ersetzen wir das bisherige <code>pass</code> von Zeile 78 in <code>s_authenticate_player()</code> des vorigen Abschnitts, durch die folgenden Zeilen:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">78</span><span>		<span style=color:#66d9ef>var</span> now :<span style=color:#f92672>=</span> <span style=color:#a6e22e>int</span>(Time<span style=color:#f92672>.</span>get_unix_time_from_system())
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">79</span><span>		token <span style=color:#f92672>=</span> JWT<span style=color:#f92672>.</span>create(jwt_algorithm) \
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">80</span><span>					<span style=color:#f92672>.</span>with_issued_at(now) \
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">81</span><span>					<span style=color:#f92672>.</span>with_expires_at(now <span style=color:#f92672>+</span> <span style=color:#ae81ff>30</span>) \
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">82</span><span>					<span style=color:#f92672>.</span>with_claim(<span style=color:#e6db74>&#34;acc&#34;</span>, username) \
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">83</span><span>					<span style=color:#f92672>.</span>sign(jwt_algorithm)</span></span></code></pre></div><p>Dadurch erzeugen wir einen Token mit einer G√ºltigkeit von 30 Sekunden, welcher im Claim <code>acc</code> den Accountnamen des authentifizierten Game-Clients enth√§lt. Der Game-Client hat somit ca. 30 Sekunden Zeit, sich beim World-Server mit diesem Token zu authentifizieren, sofern die Systemzeiten von Authentication- und World-Server ann√§hernd √ºbereinstimmen.</p><h3 class="title is-4" id=der-n√§chste-schritt>Der n√§chste Schritt</h3><div class="message is-warning"><div class=message-body>F√ºr einen Produktivbetrieb muss die gesamte Netzwerkkommunikation verschl√ºsselt werden, schlie√ülich werden Passw√∂rter √ºbermittelt. Das ist mit <a href=https://de.wikipedia.org/wiki/Datagram_Transport_Layer_Security target=_blank rel="noopener nofollow noreferrer">DTLS</a> m√∂glich. Bei DTLS handelt es sich um das UDP-√Ñquivalent zu TLS, was bspw. bei HTTPS genutzt wird. Wir werden uns in einem sp√§teren Teil dieser Tutorialserie mit der Integration von DTLS besch√§ftigen.</div></div><p>Im n√§chsten Artikel wird es um den n√§chsten Schritt gehen: Der Game-Client sendet den erhaltenen Token an den World-Server, welcher den Token validiert und im Erfolgsfall die Verbindung aufrechterh√§lt.</p></div></article><footer class=columns><div class="column has-text-left"><a href=/de/blog/2023/network-tutorial-3-login-1/ class="button right"><span class=icon-text><span class=icon><i class="fa fa-angle-left"></i></span><span>Netzwerktutorial 3: Login 1 - Der Game-Client</span></span></a></div><div class="column has-text-right"><a href=/de/blog/2023/network-tutorial-5-login-3/ class="button left"><span class=icon-text><span>Netzwerktutorial 5: Login 3 - World-Server</span><span class=icon><i class="fa fa-angle-right"></i></span></span></a></div></footer></div></div></div></section><footer class=footer><div class="container is-fluid has-text-centered"><ul class=socnet-icons><span class=icon><a href=//github.com/somethinglikegames target=_blank rel=noopener title=GitHub class="fab fa-github"></a></span>
<span class=icon><a href=//youtube.com/@somethinglikegames target=_blank rel=noopener title=YouTube class="fab fa-youtube"></a></span>
<span id=cloaked-c285a88a01></span>
<script id=cloaked-script-c285a88a01>var cloakElement=document.getElementById("cloaked-c285a88a01"),link=document.createElement("a"),address="ed.semagekilgnihtemos@ofni".split("").reverse().join("");link.href="mailto:"+address,link.classList="far fa-envelope",link.title="email",cloakElement.parentNode.replaceChild(link,cloakElement)</script></ul><p class=copyright><a href=https://www.somethinglikegames.de/de/legal_notice/>Impressum</a> &mdash;
<a href=https://www.somethinglikegames.de/de/privacy_policy/>Datenschutzerkl√§rung</a> &mdash;
¬©2023 Tobias Wink<br>Powered by <a href=https://gohugo.io/ title=0.109.0 target=_blank rel=noopener>Hugo</a></p></div></footer><script src=/js/navbar.min.js defer></script>
<script src=/js/copy-code-button.min.js defer></script></body></html>